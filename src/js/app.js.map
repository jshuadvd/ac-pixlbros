{"version":3,"sources":["index.js"],"names":["lon","fovMin","fovMax","onPointerDownPointerX","onPointerDownLon","blocked","curPosX","bar","ProgressBar","Path","easing","duration","set","THREE","DefaultLoadingManager","onProgress","item","loaded","total","percent","animate","TweenMax","to","$","autoAlpha","display","fixed","toFixed","html","audio","document","createElement","source","src","appendChild","camera","container","color","controls","clock","delta","deviceControls","h","hotspot","hsParticles","info","layer","logoGeo","logoMaterial","logoMesh","logoTexture","marker","mesh","materials","mouse","mousePos","objects","parameters","particles","particleMaterial","rainDensity","rainGeometry","raycaster","renderer","rotateSpeed","scene","size","smokeParticles","spotLight","spotLightHelper","sprite","stats","hotspots","hotspotObjects","content","header","body","feature","type","location","position","isUserInteracting","onMouseDownMouseX","onMouseDownMouseY","onMouseDownLon","lat","onMouseDownLat","phi","theta","getElementById","selectedObjects","loader","renderPass","outlinePass","composer","effectFXAA","controlsEnabled","showingModal","havePointerLock","element","pointerlockchange","event","pointerLockElement","mozPointerLockElement","webkitPointerLockElement","blocker","style","instructions","pointerlockerror","addEventListener","pointerLock","innerHTML","requestPointerLock","mozRequestPointerLock","webkitRequestPointerLock","test","navigator","userAgent","fullscreenchange","fullscreenElement","mozFullscreenElement","mozFullScreenElement","removeEventListener","requestFullscreen","mozRequestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","init","width","window","innerWidth","height","innerHeight","devicePixelRatio","WebGLRenderer","antialias","shadowMap","enabled","setClearColor","setPixelRatio","setSize","PerspectiveCamera","target","Vector3","Scene","geometry","SphereGeometry","scale","material","MeshBasicMaterial","map","TextureLoader","load","fog","Mesh","name","add","initStats","DeviceOrientationControls","Raycaster","Vector2","buildHotspots","PointerLockControls","getObject","Clock","EffectComposer","RenderPass","addPass","OutlinePass","edgeStrength","edgeGlow","edgeThickness","pulsePeriod","visibleEdgeColor","r","g","b","onLoad","texture","patternTexture","wrapS","RepeatWrapping","wrapT","lod","ShaderPass","FXAAShader","uniforms","value","renderToScreen","domElement","getPosition","onDocumentMouseDown","onDocumentMouseMove","onDocumentMouseUp","onDocumentTouchStart","onDocumentMouseWheel","preventDefault","dataTransfer","dropEffect","opacity","reader","FileReader","image","result","needsUpdate","readAsDataURL","files","onWindowResize","initRain","buildHotspot","JSONLoader","hotspotObject","index","center","box","Box3","setFromObject","x","y","z","rotation","Math","PI","console","log","random","toString","substring","hitboxGeo","BoxBufferGeometry","getSize","hitboxMat","wireframe","hitboxMesh","hotspotLocation","group","Group","buildSmoke","light","DirectionalLight","directionalLight","normalize","smokeTexture","ImageUtils","loadTexture","smokeMaterial","MeshLambertMaterial","transparent","smokeGeo","PlaneGeometry","p","particle","push","evolveSmoke","sp","length","crossOrigin","evolveHotspot","hs","Geometry","sprite1","sprite2","sprite3","sprite4","sprite5","i","vertex","vertices","PointCloudMaterial","blending","AdditiveBlending","depthTest","setHSL","PointCloud","animateRain","time","Date","now","children","object","translateY","aspect","updateProjectionMatrix","clientX","touches","clientY","addSelectedObject","checkRaycasterCollisions","setFromCamera","intersects","intersectObjects","items","filter","intersect","match","forEach","parent","indexOf","hideModal","fov","onComplete","renderFeatureMesh","find","append","CubeGeometry","cube","pointLight","PointLight","reqAnimFrame","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","msRequestAnimationFrame","render","spawnModal","css","top","on","charCode","text","exitPointerLock","rotateHotspots","movementX","mozMovementX","webkitMovementX","movementY","mozMovementY","webkitMovementY","deltaY","update","max","min","degToRad","sin","cos","lookAt","getDelta","Number","undefined","scrollLeft","documentElement","scrollTop","offsetLeft","offsetTop","TweenLite","ticker","Stats","left","zIndex"],"mappings":"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","file":"app.js","sourcesContent":["let lon = 30;\n// let lat = 0;\n// let phi = 0;\n// let theta = 0;\nlet fovMin = 75;\nlet fovMax = 50;\n// let zoomed = false;\n\nlet onPointerDownPointerX;\nlet onPointerDownLon;\n// let onPointerDownLat;\nlet blocked = false;\nlet curPosX = 0;\n\n//************************************************************************//\n//                             Init Loader                                //\n//************************************************************************//\n\nvar bar = new ProgressBar.Path('.st0', {\n\teasing: 'easeInOut',\n\tduration: 1400\n});\nbar.set(0)\n\nTHREE.DefaultLoadingManager.onProgress = function ( item, loaded, total ) {\n\tlet percent = loaded/total\n\tbar.animate(percent, function() {\n\t\tTweenMax.to($('#loader') , 0.3, {autoAlpha: 0, display: 'none'});\n\t});\n\tlet fixed = (percent*100).toFixed(0);\n\t$('text').html(`${fixed}%`);\n};\n\n\n//************************************************************************//\n//                             Init Audio                                 //\n//************************************************************************//\n\nlet audio = document.createElement('audio');\nlet source = document.createElement('source');\nsource.src = '/audio/AC-Trailer.mp3';\naudio.appendChild(source);\n// audio.play();\n\n//************************************************************************//\n//                              Variables                           \t  //\n//************************************************************************//\n\nlet camera, container, color, controls, clock, delta, deviceControls, h, hotspot, hsParticles = [], info, layer = false, logoGeo, logoMaterial, logoMesh, logoTexture, marker, mesh, materials = [], mouse, mousePos, objects = [], parameters, particles, particleMaterial, rainDensity = 20000, rainGeometry, raycaster, renderer, rotateSpeed = 0.1, scene, size, smokeParticles = [], spotLight, spotLightHelper, sprite, stats; \n\nlet hotspots = [];\nlet hotspotObjects = [\n\t{\n\t\tcontent: {\n\t\t\theader: '',\n\t\t\tbody: ''\n\t\t},\n\t\tfeature: {\n\t\t\ttype: 'mesh',\n\t\t\tlocation: ''\n\t\t},\n\t\tposition: [450, 0, 150],\n\t},\n\t{\n\t\tposition: [370, 0, 280],\n\t},\n\t{\n\t\tposition: [25, 0, 400],\n\t},\n\t{\n\t\tposition: [-115, 0, 400],\n\t},\n\t{\n\t\tposition: [-400, 0, 205],\n\t},\n\t{\n\t\tposition: [-445, 0, 30],\n\t},\n\t{\n\t\tposition: [-265, 0, -380],\n\t},\n\t{\t\n\t\tposition: [-60, 0, -455],\n\t},\n\t{\n\t\tposition: [125, 0, -455],\n\t},\n\t{\n\t\tposition: [400, 0, -205]\n\t},\n];\n\nlet isUserInteracting = true,\nonMouseDownMouseX = 0, onMouseDownMouseY = 0,\nonMouseDownLon = 0,\nlat = 0, onMouseDownLat = 0,\nphi = 0, theta = 0;\n\ncontainer = document.getElementById( 'container' );\n\nlet selectedObjects = [];\nlet loader;\nlet renderPass;\nlet outlinePass;\nlet composer;\nlet effectFXAA;\nlet controlsEnabled;\nlet showingModal = false;\n\nvar havePointerLock = 'pointerLockElement' in document || 'mozPointerLockElement' in document || 'webkitPointerLockElement' in document;\n\nif (havePointerLock) {\n\tvar element = document.body;\n\tvar pointerlockchange = function(event) {\n\t\tif(showingModal) return;\n\t\tif (document.pointerLockElement === element || document.mozPointerLockElement === element || document.webkitPointerLockElement === element) {\n\t\t\tcontrolsEnabled = true;\n\t\t\t// controls.enabled = true;\n\t\t\tblocker.style.display = 'none';\n\t\t} else {\n\t\t\t// controls.enabled = false;\n\t\t\tcontrolsEnabled = false;\n\t\t\tblocker.style.display = '-webkit-box';\n\t\t\tblocker.style.display = '-moz-box';\n\t\t\tblocker.style.display = 'box';\n\t\t\tinstructions.style.display = '';\n\t\t}\n\t};\n\n\tvar pointerlockerror = function(event) {\n\t\tinstructions.style.display = '';\n\t};\n\n\t// Hook pointer lock state change events\n\tdocument.addEventListener('pointerlockchange', pointerlockchange, false);\n\tdocument.addEventListener('mozpointerlockchange', pointerlockchange, false);\n\tdocument.addEventListener('webkitpointerlockchange', pointerlockchange, false);\n\n\tdocument.addEventListener('pointerlockerror', pointerlockerror, false);\n\tdocument.addEventListener('mozpointerlockerror', pointerlockerror, false);\n\tdocument.addEventListener('webkitpointerlockerror', pointerlockerror, false);\n\n\tinstructions.addEventListener('click', function(event) {\n\t\tinstructions.style.display = 'none';\n\t\t// Ask the browser to lock the pointer\n\t\tpointerLock();\n\t}, false);\n} else {\n\tinstructions.innerHTML = 'Your browser doesn\\'t seem to support Pointer Lock API';\n}\n\nfunction pointerLock() {\n\telement.requestPointerLock = element.requestPointerLock || element.mozRequestPointerLock || element.webkitRequestPointerLock;\n\tif (/Firefox/i.test(navigator.userAgent)) {\n\t\tvar fullscreenchange = function(event) {\n\t\t\tif (document.fullscreenElement === element || document.mozFullscreenElement === element || document.mozFullScreenElement === element) {\n\t\t\t\tdocument.removeEventListener('fullscreenchange', fullscreenchange);\n\t\t\t\tdocument.removeEventListener('mozfullscreenchange', fullscreenchange);\n\t\t\t\telement.requestPointerLock();\n\t\t\t}\n\t\t};\n\t\tdocument.addEventListener('fullscreenchange', fullscreenchange, false);\n\t\tdocument.addEventListener('mozfullscreenchange', fullscreenchange, false);\n\t\telement.requestFullscreen = element.requestFullscreen || element.mozRequestFullscreen || element.mozRequestFullScreen || element.webkitRequestFullscreen;\n\t\telement.requestFullscreen();\n\t} else {\n\t\telement.requestPointerLock();\n\t}\n}\n\ninit();\nanimate();\n\n//************************************************************************//\n//                             Init Scene                                 //\n//************************************************************************//\n\nfunction init() {\n\n\tvar width = window.innerWidth || 1;\n\tvar height = window.innerHeight || 1;\n\tvar devicePixelRatio = window.devicePixelRatio || 1;\n\trenderer = new THREE.WebGLRenderer( { antialias: false } );\n\trenderer.shadowMap.enabled = true;\n\trenderer.setClearColor( 0xa0a0a0 );\n\trenderer.setPixelRatio( 1 );\n\trenderer.setSize( width, height );\n\n\tcamera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 2000 );\n\tcamera.target = new THREE.Vector3( 0, 0, 0 );\n\tscene = new THREE.Scene();\n\n\tlet geometry = new THREE.SphereGeometry( 500, 60, 400 );\n\tgeometry.scale( - 1, 1, 1 );\n\n\tlet material = new THREE.MeshBasicMaterial( {\n\t\tmap: new THREE.TextureLoader().load( 'textures/AnimusPanorama.jpg' ),\n\t\tfog: true,\n\t});\n\t\n\tmesh = new THREE.Mesh( geometry, material );\n\tmesh.name = 'scene';\n\tscene.add( mesh );\n\t\n\tstats = initStats()\n\t\n\tdeviceControls = new THREE.DeviceOrientationControls( camera );\n\t\n\traycaster = new THREE.Raycaster();\n\tmouse = new THREE.Vector2();\n\t\n\t// Build items for raycaster clicks\n\tbuildHotspots();\n\n\t// temp sphere\n\t// var sphereMaterial = new THREE.MeshNormalMaterial();\n\t// var sphereGeometry = new THREE.SphereGeometry(200, 200, 200);\n\t// var sphere = new THREE.Mesh( sphereGeometry, sphereMaterial );\n\t// // sphere.position.set(0, 0, 0);\n\t// sphere.position.set(0, 0, 200);\n\t// // sphere.position.set(-60, 55, 0);\n\t// scene.add( sphere );\n\n\tcontrols = new THREE.PointerLockControls(camera);\n\tscene.add(controls.getObject());\n\t\n\tclock = new THREE.Clock();\n\t// renderer = new THREE.WebGLRenderer({\n\t// \tantialias: true,\n\t// \talpha: true,\n\t// });\n\t// renderer.setPixelRatio( window.devicePixelRatio );\n\t// renderer.setSize( window.innerWidth, window.innerHeight );\n\n\t// postprocessing\n\tcomposer = new THREE.EffectComposer( renderer );\n\trenderPass = new THREE.RenderPass( scene, camera );\n\tcomposer.addPass( renderPass );\n\toutlinePass = new THREE.OutlinePass( new THREE.Vector2(window.innerWidth, window.innerHeight), scene, camera);\n\n\toutlinePass.edgeStrength = 10.0;\n\toutlinePass.edgeGlow = 10.0;\n\toutlinePass.edgeThickness = 4.0;\n\toutlinePass.pulsePeriod = 5;\n\toutlinePass.visibleEdgeColor = {r: 60, g: 60, b: 60}\n\n\tcomposer.addPass( outlinePass );\n\t// @todo: prob dont need this texture but SHRUG\n\tvar onLoad = function(texture) {\n\t\toutlinePass.patternTexture = texture;\n\t\ttexture.wrapS = THREE.RepeatWrapping;\n\t\ttexture.wrapT = THREE.RepeatWrapping;\n\t};\n\tvar lod = new THREE.TextureLoader();\n\tlod.load(\n\t\t// resource URL\n\t\t'textures/tri_pattern.jpg',\n\t\t// Function when resource is loaded\n\t\tonLoad\n\t);\n\n\teffectFXAA = new THREE.ShaderPass(THREE.FXAAShader);\n\teffectFXAA.uniforms['resolution'].value.set(1 / window.innerWidth, 1 / window.innerHeight );\n\teffectFXAA.renderToScreen = true;\n\tcomposer.addPass( effectFXAA );\n\n\tcontainer.appendChild( renderer.domElement );\n\tcontainer.addEventListener(\"mousemove\", getPosition, false);\n\t\n\tdocument.addEventListener( 'mousedown', onDocumentMouseDown, false );\n\tdocument.addEventListener( 'mousemove', onDocumentMouseMove, false );\n\tdocument.addEventListener( 'mouseup', onDocumentMouseUp, false );\n\tdocument.addEventListener( 'touchstart', onDocumentTouchStart, false );\n\tdocument.addEventListener( 'wheel', onDocumentMouseWheel, false );\n\n\tdocument.addEventListener( 'dragover', function ( event ) {\n\n\t\tevent.preventDefault();\n\t\tevent.dataTransfer.dropEffect = 'copy';\n\n\t}, false );\n\n\tdocument.addEventListener( 'dragenter', function ( event ) {\n\n\t\tdocument.body.style.opacity = 0.5;\n\n\t}, false );\n\n\tdocument.addEventListener( 'dragleave', function ( event ) {\n\n\t\tdocument.body.style.opacity = 1;\n\n\t}, false );\n\n\tdocument.addEventListener( 'drop', function ( event ) {\n\n\t\tevent.preventDefault();\n\n\t\tlet reader = new FileReader();\n\t\treader.addEventListener( 'load', function ( event ) {\n\n\t\t\tmaterial.map.image.src = event.target.result;\n\t\t\tmaterial.map.needsUpdate = true;\n\n\t\t}, false );\n\t\treader.readAsDataURL( event.dataTransfer.files[ 0 ] );\n\n\t\tdocument.body.style.opacity = 1;\n\n\t}, false );\n\n\twindow.addEventListener( 'resize', onWindowResize, false );\n\t\n\tinitRain();\n\t// buildSmoke();\n\tbuildHotspot();\n\t\n\tdocument.body.appendChild( renderer.domElement );\n\n}\n\nfunction buildHotspots() {\n\tloader = new THREE.JSONLoader();\n\tloader.load('/js/ac-logo.js', function(geometry) {\n\t\thotspots = hotspotObjects.map( (hotspotObject, index) => {\n\t\t\tgeometry.center();\n\t\t\tlet scale = 10;\n\t\t\tlet hotspot = new THREE.Mesh(geometry, new THREE.MeshBasicMaterial( { color: '#870000', opacity: 1 } ));\n\t\t\thotspot.name = `hotspot-${index}`;\n\t\t\tvar box = new THREE.Box3().setFromObject(hotspot);\n\t\t\thotspot.scale.x = hotspot.scale.y = hotspot.scale.z = scale\n\t\t\thotspot.rotation.x = Math.PI\n\t\t\tconsole.log('hotspotObject', hotspotObject);\n\t\t\thotspot.hotspot = hotspotObject;\n\n\t\t\t// auto generate some stuff!\n\t\t\t// {\n\t\t\t// \tcontent: {\n\t\t\t// \t\theader: '',\n\t\t\t// \t\tbody: ''\n\t\t\t// \t},\n\t\t\t// \tfeature: {\n\t\t\t// \t\ttype: 'mesh',\n\t\t\t// \t\tlocation: ''\n\t\t\t// \t},\n\t\t\t// \tposition: [-20, 0, -475],\n\t\t\t// },\n\t\t\thotspot.hotspot.content = {};\n\t\t\thotspot.hotspot.content.header = hotspot.name;\n\t\t\thotspot.hotspot.content.body = Math.random().toString(36).substring(7);\n\n\t\t\t// hotspot.scale.x = 8\n\t\t\t// hotspot.scale.y = 10\n\t\t\t// hotspot.scale.z = 8\n\t\t\t// hotspot.rotation.y = 3\n\n\t\t\tlet hitboxGeo = new THREE.BoxBufferGeometry( box.getSize().x * scale * 1.2, 200, box.getSize().x * scale * 1.2 );\n\t\t\tlet hitboxMat = new THREE.MeshBasicMaterial({wireframe: true});\n\t\t\t// // hitboxMat.visible = false\n\t\t\tlet hitboxMesh = new THREE.Mesh( hitboxGeo, hitboxMat );\n\t\t\thitboxMesh.name = `hitbox-${index}`;\n\n\t\t\tlet hotspotLocation = hotspotObject.position;\n\n\t\t\tvar group = new THREE.Group();\n\t\t\tgroup.name = `group-${index}`\n\t\t\tgroup.position.set(hotspotLocation[0], hotspotLocation[1], hotspotLocation[2]);\n\t\t\tscene.add(group);\n\t\t\tgroup.add(hotspot);\n\t\t\tgroup.add(hitboxMesh);\n\n\t\t\treturn group;\n\n\t\t});\n\t});\n}\n\nfunction buildSmoke() {\n\t// Smoke Light\n\tlet light = new THREE.DirectionalLight(0xffffff, 1.5);\n\tlight.position.set(-1, 0, 1);\n\tscene.add(light);\n\t\n\tlet directionalLight = new THREE.DirectionalLight(0xffffff);\n\tdirectionalLight.position.set(1, 1, 1).normalize();\n\tscene.add(directionalLight);\n  \n\tlet smokeTexture = THREE.ImageUtils.loadTexture('https://s3-us-west-2.amazonaws.com/s.cdpn.io/95637/Smoke-Element.png');\n\tlet smokeMaterial = new THREE.MeshLambertMaterial({\n\t\tcolor: 0xffffff, \n\t\tmap: smokeTexture, \n\t\ttransparent: true\n\t});\n\tlet smokeGeo = new THREE.PlaneGeometry(500, 500);\n\t \n\tfor (let p = 0; p < 150; p++) {\n\t\tlet particle = new THREE.Mesh(smokeGeo,smokeMaterial);\n\t\tparticle.position.set(Math.random()*500-250,Math.random()*500-250,Math.random()*1000-100);\n\t\tparticle.rotation.z = Math.random() * 360;\n\t\tscene.add(particle);\n\t\tsmokeParticles.push(particle);\n\t}\t\n}\n\n\nfunction evolveSmoke() {\n\tlet sp = smokeParticles.length;\n\twhile(sp--) {\n\t\tsmokeParticles[sp].rotation.z += (delta * 0.2);\n\t}\n}\n\nfunction buildHotspot() {\n\tTHREE.ImageUtils.crossOrigin = ''; \n\t\n\t// for ( let i = 0; i < 10; i ++ ) {\n\t\t\n\t\t// let logoTexture = THREE.ImageUtils.loadTexture('/textures/animus_red_logo.png');\n\t\t// logoTexture.crossOrigin = 'anonymous';\n\t\t\n\t\t// let logoMaterial = new THREE.MeshLambertMaterial({\n\t\t// \tcolor: 0xffffff, \n\t\t// \tmap: logoTexture, \n\t\t// \ttransparent: true\n\t\t// });\n\t\t\n\t\t// let logoGeo = new THREE.PlaneGeometry(40, 60);\n\t\t// // let hotspots = [];\n\t\t\n\t\t// hotspot = new THREE.Mesh(logoGeo, logoMaterial);\n\t\t\n\t\t// // hotspot.position.x = Math.random() * 800 - 400;\n\t\t// // hotspot.position.y = 0;\n\t\t// // hotspot.position.z = -400;\n\t\t// // \n\t\t// // hotspot.scale.x = Math.random() * 2 + 1;\n\t\t// // hotspot.scale.y = Math.random() * 2 + 1;\n\t\t// // hotspot.scale.z = Math.random() * 2 + 1;\n\t\t// // \n\t\t// // hotspot.rotation.x = Math.random() * 2 * Math.PI;\n\t\t// // hotspot.rotation.y = Math.random() * 2 * Math.PI;\n\t\t// // hotspot.rotation.z = Math.random() * 2 * Math.PI;\n\t\t// hotspot.position.set(-45, 0, -400);\n\t\t// // hotspot.rotation.x = 0.1;\n\t\t// scene.add(hotspot);\n\t\t\n\t\t// hotspots.push(hotspot)\t\t\n\t// }\t\n\t\n\t let light = new THREE.DirectionalLight(0xffffff, 1.5);\n\t light.position.set(-1, 0, 1);\n\t scene.add(light);\n\t// for (let p = 0; p < 50; p++) {\n\t//     let particle = new THREE.Mesh(logoGeo, logoMaterial);\n\t//     particle.position.set(Math.random()*500-250,Math.random()*500-250,Math.random()*1000-100);\n\t//     particle.rotation.z = Math.random() * 360;\n\t//     scene.add(particle);\n\t//     hsParticles.push(particle);\n\t// }\t\n}\n\nfunction evolveHotspot() {\n\tlet hs = hsParticles.length;\n\twhile(hs--) {\n\t\thsParticles[hs].rotation.z += (delta * 0.2);\n\t}\n}\n\nfunction initRain() {\n\trainGeometry = new THREE.Geometry();\n\n\tlet sprite1 = THREE.ImageUtils.loadTexture( \"textures/rain1.png\" ),\n\tsprite2 = THREE.ImageUtils.loadTexture( \"textures/rain2.png\" ),\n\tsprite3 = THREE.ImageUtils.loadTexture( \"textures/rain3.png\" ),\n\tsprite4 = THREE.ImageUtils.loadTexture( \"textures/rain4.png\" ),\n\tsprite5 = THREE.ImageUtils.loadTexture( \"textures/rain5.png\" );\n\n\tfor (let i = 0; i < rainDensity; i++ ) {\n\t\tlet vertex = new THREE.Vector3();\n\t\tvertex.x = Math.random() * 2000 - 1000;\n\t\tvertex.y = Math.random() * 4000 + 500;\n\t\tvertex.z = Math.random() * 2000 - 1000;\n\n\t\trainGeometry.vertices.push( vertex );\n\t}\n\n\tparameters = [ [ [1.0, 0.2, 0.5], \tsprite2, 20 ],\n\t\t\t\t   [ [0.95, 0.1, 0.5], \tsprite3, 15 ],\n\t\t\t\t   [ [0.90, 0.05, 0.5], sprite1, 10 ],\n\t\t\t\t   [ [0.85, 0, 0.5], \tsprite5, 8 ],\n\t\t\t\t   [ [0.80, 0, 0.5], \tsprite4, 5 ],\n\t\t\t\t   ];\n\n\tfor (let i = 0; i < parameters.length; i++ ) {\n\n\t\tcolor  = parameters[i][0];\n\t\tsprite = parameters[i][1];\n\t\tsize   = parameters[i][2];\n\n\t\tmaterials[i] = new THREE.PointCloudMaterial({ \n\t\t\tsize: size, \n\t\t\tmap: sprite, \n\t\t\tblending: THREE.AdditiveBlending, \n\t\t\tdepthTest: false, \n\t\t\ttransparent : true \n\t\t});\n\t\tmaterials[i].color.setHSL( color[0], color[1], color[2] );\n\n\t\tparticles = new THREE.PointCloud( rainGeometry, materials[i] );\n\n\t\tparticles.rotation.z = Math.random() * 0.20 + 0.10;\n\n\t\tscene.add( particles );\n\t}\n}\n\nfunction animateRain() {\n\t// console.log(\"I'M ANIMATING THINGS\");\n\tlet time = Date.now() * 0.00005;\n\n\tfor (let i = 0; i < scene.children.length; i++ ) {\n\n\t\tlet object = scene.children[i];\n\t\t\n\t\tif ( object instanceof THREE.PointCloud ) {\n\t\t\t// Not getting into the log here\n\t\t\tconsole.log(\"I'M ANIMATING THINGS\");\n\t\t\tif (i == 0) {\n\t\t\t\tobject.translateY(-10);\n\t\t\t}\n\n\t\t\tif (i > 0) {\n\t\t\t\tif (layer)\n\t\t\t\t\tobject.translateY(-10);\n\t\t\t\telse\n\t\t\t\t\tif(scene.children[i-1].position.y < ((window.innerHeight * -1) / 2 - 1000))\n\t\t\t\t\t\tobject.translateY(-10);\n\t\t\t}\n\n\t\t\tif ((object.position.y < window.innerHeight * -1 * 5)) {\n\t\t\t\t\tobject.position.y = 500;\n\t\t\t\t\tobject.position.x = 0;\n\t\t\t\t\tif (i == 0) layer = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tfor (let i = 0; i < materials.length; i++ ) {\n\n\t\tcolor = parameters[i][0];\n\n\t\th = ( 360 * ( color[0] + time ) % 360 ) / 360;\n\t\tmaterials[i].color.setHSL( h, color[1], color[2] );\n\n\t}\n}\n\nfunction onWindowResize() {\n\tvar width = window.innerWidth || 1;\n\tvar height = window.innerHeight || 1;\n\tvar devicePixelRatio = window.devicePixelRatio || 1;\n\tcamera.aspect = width / height;\n\tcamera.updateProjectionMatrix();\n\trenderer.setSize( width, height );\n\tcomposer.setSize( width, height );\n\teffectFXAA.uniforms['resolution'].value.set(1 / window.innerWidth, 1 / window.innerHeight );\n}\n\nfunction onDocumentTouchStart( event ) {\n\tevent.preventDefault();\n\tevent.clientX = event.touches[0].clientX;\n\tevent.clientY = event.touches[0].clientY;\n\tonDocumentMouseDown( event );\n}\n\nfunction addSelectedObject(object) {\n\tconsole.log('addSelectedObject', object.name)\n\tselectedObjects = [];\n\tselectedObjects.push(object);\n}\n\nfunction checkRaycasterCollisions() {\n\traycaster.setFromCamera(mouse, camera);\n\tlet intersects = raycaster.intersectObjects(scene.children, true);\n\t// @todo: we need to add deselect here\n\tlet items = intersects.filter( intersect => intersect.object.name.match(/hitbox/) )\n\tif(items.length) {\n\t\titems.forEach((item) => {\n\t\t\tlet target = item.object.parent.children[0]\n\t\t\tif(selectedObjects.indexOf(target) === -1) {\n\t\t\t\taddSelectedObject(target);\n\t\t\t}\n\t\t});\n\t} else {\n\t\tselectedObjects = [];\n\t}\n\toutlinePass.selectedObjects = selectedObjects;\n}\n\nfunction hideModal() {\n\tlet duration = 550/1000\n\tshowingModal = false;\n\tpointerLock();\n\tTweenMax.to($('.modal-container') , 0.3, {autoAlpha: 0})\n\tTweenMax.to(camera, duration, {fov: fovMin, onComplete: function() {\n\t\tblocked = false;\n\t}})\n}\n\nfunction renderFeatureMesh() {\n\tvar feature = $('.feature');\n\n\tif(feature.find('canvas').length) return;\n\tvar scene = new THREE.Scene();\n\tvar camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);\n\n\tvar renderer = new THREE.WebGLRenderer();\n\trenderer.setSize(feature.width(), feature.height());\n\tfeature.append(renderer.domElement);\n\n\tvar geometry = new THREE.CubeGeometry(5, 5, 5);\n\tvar material = new THREE.MeshLambertMaterial({\n\t\tcolor: 0x00fff0\n\t});\n\tvar cube = new THREE.Mesh(geometry, material);\n\tscene.add(cube);\n\n\tcamera.position.z = 12;\n\n\tvar pointLight = new THREE.PointLight(0xFFFFFF);\n\n\tpointLight.position.x = 10;\n\tpointLight.position.y = 50;\n\tpointLight.position.z = 130;\n\n\tscene.add(pointLight);\n\n\tvar reqAnimFrame = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.msRequestAnimationFrame;\n\n\tvar render = function() {\n\t\treqAnimFrame(render);\n\n\t\tvar delta = Math.random() * (0.06 - 0.02) + 0.02;\n\n\t\tcube.rotation.x += delta;\n\t\tcube.rotation.y += delta;\n\t\tcube.rotation.z -= delta;\n\n\t\trenderer.render(scene, camera);\n\t};\n\n\trender();\n}\n\nfunction spawnModal(hotspot) {\n\t$('.modal-container').css({top: 0})\n\t$('.modal-container .close').on('click', hideModal);\n\t$('.overlay').on('click', hideModal);\n\t$(document).on('keydown', (event) => {\n\t\tif(event.charCode === 0) {\n\t\t\thideModal();\n\t\t} \n\t})\n\t$('.modal .content h1').text(hotspot.content.header);\n\t$('.modal .content p').text(hotspot.content.body);\n\trenderFeatureMesh();\n}\n\nfunction onDocumentMouseDown( event ) {\n\n\tif(!controlsEnabled) return;\n\n\tif(selectedObjects.length) {\n\t\tconsole.log('DO STUFF', );\n\t\tlet hotspot = selectedObjects[0].hotspot;\n\t\tlet duration = 550/1000\n\t\tshowingModal = true;\n\t\tcontrolsEnabled = false;\n\t\tdocument.exitPointerLock();\n\t\tTweenMax.to($('.modal-container') , 0.3, {autoAlpha: 1})\n\t\tTweenMax.to(camera, duration, {fov: fovMax, onComplete: spawnModal(hotspot)})\n\t\t// selectedObjects[0]\n\t}\n}\n\nfunction rotateHotspots() {\n\thotspots.forEach( hotspot => hotspot.rotation.y += rotateSpeed * 0.5 );\n}\n\nfunction onDocumentMouseMove( event ) {\n\tisUserInteracting = true;\n\t\n\tvar movementX = event.movementX || event.mozMovementX || event.webkitMovementX || 0;\n\tvar movementY = event.movementY || event.mozMovementY || event.webkitMovementY || 0;\n\n\tif(controlsEnabled) {\n\t\tcurPosX += movementX;\n\t\tlon = curPosX\n\t}\n\t// if ( isUserInteracting === true ) {\n\t// \tlon = ( onPointerDownPointerX - event.clientX ) * 0.1 + onPointerDownLon;\n\t// \t// lat = ( event.clientY - onPointerDownPointerY ) * 0.1 + onPointerDownLat;\n\t// }\n}\n\nfunction onDocumentMouseUp( event ) {\n\tisUserInteracting = false;\n}\n\n// Zoom in & out | Need to limit this to the starting point and a endind point\nfunction onDocumentMouseWheel( event ) {\n\t// if (camera.fov > 75) {\n\t// \tcamera.fov = 75\n\t// } else {\n\t// \tcamera.fov += event.deltaY * 0.01;\n\t// \tcamera.updateProjectionMatrix();\n\t// }\n\tcamera.fov += event.deltaY * 0.02;\n\tcamera.updateProjectionMatrix();\n}\n\nfunction animate() {\n\trequestAnimationFrame( animate );\n\tupdate();\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n}\n\nfunction update() {\n\t// if ( isUserInteracting === false ) {\n\t// \t// lon += 0.1;\n\t// }\n\tlat = Math.max( - 85, Math.min( 85, lat ) );\n\tphi = THREE.Math.degToRad( 90 - lat );\n\ttheta = THREE.Math.degToRad( lon );\n\n\tcamera.target.x = 500 * Math.sin( phi ) * Math.cos( theta );\n\t// camera.target.y = 500 * Math.cos( phi );\n\tcamera.target.z = 500 * Math.sin( phi ) * Math.sin( theta );\n\tcamera.lookAt( camera.target );\n\n\t/*\n\t// distortion\n\tcamera.position.copy( camera.target ).negate();\n\t*/\n\t// let delta = clock.getDelta(), speed = delta * CAMERAMOVESPEED;\n\t// controls.update(delta);\n\t// spotLight.target = marker;\n\t// controls.update()\n\t\n\t// spotLightHelper.update()\n\tstats.update()\n\tdelta = clock.getDelta();\n\n\tevolveSmoke();\n\tevolveHotspot();\n\t// animateRain();\n\t// rotateHotspot();\n\trotateHotspots();\n\n\tcheckRaycasterCollisions();\n\t// rainEngine.update(0.01 * 0.5)\n\ttheta += 0.1;\n\t// let radius = 600;\n\t// camera.position.x = radius * Math.sin( THREE.Math.degToRad( theta ) );\n\t// camera.position.y = radius * Math.sin( THREE.Math.degToRad( theta ) );\n\t// camera.position.z = radius * Math.cos( THREE.Math.degToRad( theta ) );\n\t// camera.lookAt( scene.position );\n\t// renderer.render( scene, camera );\n\tcamera.updateProjectionMatrix();\n\tcomposer.render();\n\t// renderer.autoClear = true;\n\t// renderer.setClearColor( 0xfff0f0 );\n\t// renderer.setClearAlpha( 0.0 );\n}\n\nfunction getPosition(event) {\n\tlet x = new Number();\n\tlet y = new Number();\n\t\n\tif (event.x != undefined && event.y != undefined) {\n\t\tx = event.x;\n\t\ty = event.y;\n\t} else { // Firefox method to get the position\n\t\tx = event.clientX + document.body.scrollLeft +\n\t\tdocument.documentElement.scrollLeft;\n\t\ty = event.clientY + document.body.scrollTop +\n\t\tdocument.documentElement.scrollTop;\n\t}\n\tx -= container.offsetLeft;\n\ty -= container.offsetTop;\t\n\t// alert(\"x: \" + x + \"  y: \" + y);\n\tconsole.log(\"x: \" + x + \"  y: \" + y);\n}\n\nTweenLite.ticker.addEventListener(\"tick\", render);\n\nfunction initStats() {\n\t// stats.setMode(0); // 0: fps, 1: ms\n\t// Align top-left\n\tstats = new Stats();\n\tstats.domElement.style.position = 'absolute';\n\t// stats.domElement.style.bottom = '0px';\n\tstats.domElement.style.left = '0px';\n\tstats.domElement.style.top = '0px';\n\tstats.domElement.style.zIndex = 100;\n\tcontainer.appendChild(stats.domElement);\n\treturn stats;\n}"]}