{"version":3,"sources":["index.js"],"names":["position","lon","curPosX","fovMin","fovMax","onPointerDownPointerX","onPointerDownLon","blocked","showLoader","bar","ProgressBar","Path","easing","duration","set","percent","int","setInterval","clearInterval","animate","TweenMax","to","$","autoAlpha","display","fixed","toFixed","html","hide","setupButtons","each","$el","clone","find","attr","append","after","on","key","console","log","buttons","event","currentTarget","Modal","hotspot","modal","item","content","prototype","prev","onComplete","offset","slides","length","image","next","showSliderControls","fadeIn","i","showingModal","camera","fov","show","subid","firstSlide","spawnModal","audio","Audio","playAudio","document","ready","index","el","get","stopPropagation","handleButtonClick","offLine","container","parents","pause","play","color","controls","clock","delta","deviceControls","h","info","logoGeo","logoMaterial","logoMesh","logoTexture","marker","mesh","materials","mouse","mousePos","objects","parameters","particles","particleMaterial","rainDensity","rainGeometry","raycaster","renderer","scene","size","smokeParticles","spotLight","spotLightHelper","sprite","stats","layer","hsParticles","rotateSpeed","hotspots","hotspotObjects","id","onMouseDownMouseX","onMouseDownMouseY","onMouseDownLon","lat","onMouseDownLat","phi","theta","getElementById","containerWidth","clientWidth","containerHeight","clientHeight","selectedObjects","loader","renderPass","outlinePass","composer","effectFXAA","initialOrientation","isUserInteracting","projector","THREE","Projector","mouseVector","Vector3","currentHotspot","touchDevice","window","DocumentTouch","init","width","innerWidth","height","innerHeight","devicePixelRatio","WebGLRenderer","antialias","shadowMap","enabled","setClearColor","setPixelRatio","setSize","PerspectiveCamera","target","Scene","geometry","SphereGeometry","scale","material","MeshBasicMaterial","map","TextureLoader","load","fog","Mesh","name","add","initStats","Raycaster","Vector2","buildHotspots","Clock","EffectComposer","RenderPass","addPass","OutlinePass","edgeStrength","edgeGlow","edgeThickness","pulsePeriod","visibleEdgeColor","r","g","b","onLoad","texture","patternTexture","wrapS","RepeatWrapping","wrapT","lod","ShaderPass","FXAAShader","uniforms","value","renderToScreen","appendChild","domElement","addEventListener","onDocumentMouseDown","onDocumentMouseMove","onDocumentMouseUp","onDocumentTouchStart","onWindowResize","initRain","orientCamera","body","getUrlParams","urlParams","match","pl","search","decode","s","decodeURIComponent","replace","query","location","substring","exec","parseInt","filter","buttonClicks","fb","JSONLoader","hotspotObject","center","oldMat","opacity","box","Box3","setFromObject","x","y","z","rotation","Math","PI","hitboxGeo","BoxBufferGeometry","getSize","hitboxMat","visible","hitboxMesh","hotspotLocation","group","Group","buildSmoke","light","DirectionalLight","directionalLight","normalize","smokeTexture","ImageUtils","loadTexture","smokeMaterial","MeshLambertMaterial","transparent","smokeGeo","PlaneGeometry","p","particle","random","push","evolveSmoke","sp","Geometry","sprite1","sprite2","sprite3","sprite4","sprite5","vertex","vertices","PointCloudMaterial","blending","AdditiveBlending","depthTest","setHSL","PointCloud","animateRain","time","Date","now","children","object","translateY","aspect","updateProjectionMatrix","preventDefault","clientX","touches","clientY","addSelectedObject","checkRaycasterCollisions","mouse3D","setFromCamera","intersects","intersectObjects","items","intersect","forEach","parent","indexOf","addClass","removeClass","css","top","keyCode","makeUrlParams","str","undefined","tweenArc","start","end","relativity","absDelta","abs","so","currentLon","hotspotLon","data","rotateHotspots","movementX","mozMovementX","webkitMovementX","movementY","mozMovementY","webkitMovementY","onDocumentMouseWheel","deltaY","requestAnimationFrame","update","max","min","degToRad","sin","cos","lookAt","getDelta","render","TweenLite","ticker","Stats","style","left","zIndex","deviceOrientationListener","deg2rad","beta","gamma","alpha","setupControllerEventHandlers","controllerEl","querySelector","controllerDefaultText","textContent","controllerSelectorEl","compassCalibrationPopupEl","cursor","innerText","useQuaternions"],"mappings":";;AACA,IAAIA,WAAW;AACdC,MAAK;AADS,CAAf;AAGA,IAAIC,UAAU,EAAd;AACA,IAAIC,SAAS,EAAb;AACA,IAAIC,SAAS,EAAb;AACA,IAAIC,8BAAJ;AACA,IAAIC,yBAAJ;AACA,IAAIC,UAAU,KAAd;;AAGA;AACA;AACA;;AAEA,IAAIC,aAAa,KAAjB;;AAEA,IAAGA,UAAH,EAAe;AAAA,KACVC,GADU;;AAAA;AACVA,QAAM,IAAIC,YAAYC,IAAhB,CAAqB,MAArB,EAA6B;AACtCC,WAAQ,WAD8B;AAEtCC,aAAU;AAF4B,GAA7B,CADI;;AAKdJ,MAAIK,GAAJ,CAAQ,CAAR;;AAEA,MAAIC,UAAU,GAAd;AACA,MAAIC,MAAMC,YAAY,YAAW;AAChCF,cAAW,GAAX;AACA,OAAGA,WAAW,GAAd,EAAmB;AAClBG,kBAAcF,GAAd;AACA,IAFD,MAEO;AACNP,QAAIU,OAAJ,CAAYJ,OAAZ,EAAqB,YAAM;AAC1BK,cAASC,EAAT,CAAYC,EAAE,SAAF,CAAZ,EAA2B,GAA3B,EAAgC,EAACC,WAAW,CAAZ,EAAeC,SAAS,MAAxB,EAAhC;AACA,KAFD;AAGA,QAAIC,QAAQ,CAACV,UAAQ,GAAT,EAAcW,OAAd,CAAsB,CAAtB,CAAZ;AACAJ,MAAE,MAAF,EAAUK,IAAV,CAAkBF,KAAlB;AACA;AACD,GAXS,EAWP,GAXO,CAAV;;AAaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5Bc;AA6Bd,CA7BD,MA6BO;AACNH,GAAE,SAAF,EAAaM,IAAb;AACA;;AAED,SAASC,YAAT,GAAwB;AACvBP,GAAE,qBAAF,EAAyBQ,IAAzB,CAA8B,YAAW;AACxC,MAAIC,MAAMT,EAAE,IAAF,CAAV;AACA,MAAIU,QAAQD,IAAIE,IAAJ,CAAS,QAAT,EAAmBD,KAAnB,GAA2BE,IAA3B,CAAgC,OAAhC,EAAyC,WAAzC,CAAZ;AACAH,MAAII,MAAJ,CAAWH,KAAX;AACA,EAJD;AAKAV,GAAE,aAAF,EAAiBQ,IAAjB,CAAsB,YAAW;AAChC,MAAIC,MAAMT,EAAE,IAAF,CAAV;AACA,MAAIU,QAAQD,IAAIC,KAAJ,GAAYE,IAAZ,CAAiB,OAAjB,EAA0B,MAA1B,CAAZ;AACAH,MAAIK,KAAJ,CAAUJ,KAAV;AACA,EAJD;AAKAV,GAAE,eAAF,EAAmBe,EAAnB,CAAsB,YAAtB,EAAoC,YAAW;AAC9C,MAAIC,MAAMhB,EAAE,IAAF,EAAQY,IAAR,CAAa,KAAb,CAAV;AACAK,UAAQC,GAAR,CAAY,YAAZ,EAA0BF,GAA1B;AACAG,UAAQH,GAAR,EAAanB,OAAb,CAAqB,CAArB;AACA,EAJD;AAKAG,GAAE,eAAF,EAAmBe,EAAnB,CAAsB,YAAtB,EAAoC,UAACK,KAAD,EAAW;AAC9C,MAAIJ,MAAMhB,EAAEoB,MAAMC,aAAR,EAAuBT,IAAvB,CAA4B,KAA5B,CAAV;AACAO,UAAQH,GAAR,EAAaxB,GAAb,CAAiB,CAAjB;AACA,EAHD;AAIA;;AAED,IAAI2B,UAAU,EAAd;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,SAASG,KAAT,CAAeC,OAAf,EAAwB;AACvB,MAAKC,KAAL,GAAaxB,EAAE,QAAF,CAAb;AACA,MAAKyB,IAAL,GAAY,KAAKD,KAAL,CAAWb,IAAX,CAAgB,OAAhB,CAAZ;AACA,MAAKe,OAAL,GAAe,KAAKF,KAAL,CAAWb,IAAX,CAAgB,UAAhB,CAAf;AACA;;AAEDW,MAAMK,SAAN,GAAkB;AACjBC,KADiB,kBACV;AAAA;;AACNX,UAAQC,GAAR,CAAY,OAAZ;AACA,MAAIQ,UAAU,KAAKA,OAAnB;AACA,MAAInC,WAAW,KAAKA,QAApB;AACAO,WAASC,EAAT,CAAY2B,OAAZ,EAAqBnC,QAArB,EAA+B,EAACU,WAAW,CAAZ,EAAe4B,YAAY,sBAAM;AAC/D,UAAKC,MAAL,GAAc,MAAKA,MAAL,KAAgB,CAAhB,GAAoB,MAAKP,OAAL,CAAaQ,MAAb,CAAoBC,MAApB,GAA2B,CAA/C,GAAmD,MAAKF,MAAL,GAAY,CAA7E;AACA,UAAKL,IAAL,CAAUb,IAAV,CAAe,KAAf,EAAsB,MAAKW,OAAL,CAAaQ,MAAb,CAAoB,MAAKD,MAAzB,EAAiCG,KAAvD;AACAnC,aAASC,EAAT,CAAY2B,OAAZ,EAAqBnC,QAArB,EAA+B,EAACU,WAAW,CAAZ,EAA/B;AACA,IAJ8B,EAA/B;AAKA,EAVgB;AAWjBiC,KAXiB,kBAWV;AAAA;;AACNjB,UAAQC,GAAR,CAAY,OAAZ;AACA,MAAIQ,UAAU,KAAKA,OAAnB;AACA,MAAInC,WAAW,KAAKA,QAApB;AACAO,WAASC,EAAT,CAAY2B,OAAZ,EAAqBnC,QAArB,EAA+B,EAACU,WAAW,CAAZ,EAAe4B,YAAY,sBAAM;AAC/D,WAAKC,MAAL,GAAc,OAAKA,MAAL,GAAY,CAAZ,KAAkB,OAAKP,OAAL,CAAaQ,MAAb,CAAoBC,MAAtC,GAA+C,CAA/C,GAAmD,OAAKF,MAAL,GAAY,CAA7E;AACA,WAAKL,IAAL,CAAUb,IAAV,CAAe,KAAf,EAAsB,OAAKW,OAAL,CAAaQ,MAAb,CAAoB,OAAKD,MAAzB,EAAiCG,KAAvD;AACAnC,aAASC,EAAT,CAAY2B,OAAZ,EAAqBnC,QAArB,EAA+B,EAACU,WAAW,CAAZ,EAA/B;AACA,IAJ8B,EAA/B;AAKA,EApBgB;;AAqBjBV,WAAU,IArBO;AAsBjBuC,SAAQ,CAtBS;AAuBjBK,mBAvBiB,gCAuBI;AACpBnC,IAAE,kBAAF,EAAsBoC,MAAtB;AACA,EAzBgB;AA0BjB9B,KA1BiB,kBA0BV;AACN,OAAI,IAAI+B,CAAR,IAAalB,OAAb,EAAsB;AACrBA,WAAQkB,CAAR,EAAW7C,GAAX,CAAe,CAAf;AACA;AACD,MAAID,WAAW,MAAI,IAAnB;AACA+C,iBAAe,KAAf;AACA;AACAxC,WAASC,EAAT,CAAYC,EAAE,kBAAF,CAAZ,EAAoC,GAApC,EAAyC,EAACC,WAAW,CAAZ,EAAzC;AACAH,WAASC,EAAT,CAAYwC,MAAZ,EAAoBhD,QAApB,EAA8B,EAACiD,KAAK3D,MAAN,EAAcgD,YAAY,sBAAW;AAClE5C,cAAU,KAAV;AACA,IAF6B,EAA9B;AAGA,EArCgB;AAsCjBwD,KAtCiB,gBAsCZlB,OAtCY,EAsCHmB,KAtCG,EAsCI;AACpB,OAAKnB,OAAL,GAAeA,OAAf;AACA,OAAKmB,KAAL,GAAaA,KAAb;AACA,OAAKZ,MAAL,GAAc,CAAd;AACA;AACA;AACA,MAAIvC,WAAW,MAAI,IAAnB;AACA+C,iBAAe,IAAf;AACA,MAAGf,QAAQQ,MAAR,IAAkBR,QAAQQ,MAAR,CAAeC,MAAf,GAAwB,CAA7C,EAAgD;AAC/C,QAAKG,kBAAL;AACA,OAAIQ,aAAapB,QAAQQ,MAAR,CAAe,KAAKD,MAApB,CAAjB;AACA9B,KAAE,cAAF,EAAkBY,IAAlB,CAAuB,KAAvB,EAA8B+B,WAAWV,KAAzC;AACA;AACDnC,WAASC,EAAT,CAAYC,EAAE,kBAAF,CAAZ,EAAoC,GAApC,EAAyC,EAACC,WAAW,CAAZ,EAAzC;AACAH,WAASC,EAAT,CAAYwC,MAAZ,EAAoBhD,QAApB,EAA8B,EAACiD,KAAK1D,MAAN,EAAc+C,YAAYe,WAAWrB,OAAX,CAA1B,EAA9B;AACA;AArDgB,CAAlB;AAuDA,IAAIC,QAAQ,IAAIF,KAAJ,EAAZ;;AAEA,IAAIuB,QAAQ,IAAIC,KAAJ,CAAU,sBAAV,CAAZ;AACA;;AAEA,IAAIC,YAAY,IAAhB;;AAEA;;AAEA/C,EAAEgD,QAAF,EAAYC,KAAZ,CAAkB,YAAW;;AAE5BjD,GAAE,eAAF,EAAmBQ,IAAnB,CAAwB,UAAC0C,KAAD,EAAQC,EAAR,EAAe;AACtC,MAAI1C,MAAMT,EAAEmD,EAAF,CAAV;AACA,MAAInC,MAAMP,IAAIG,IAAJ,CAAS,KAAT,CAAV;AACAO,UAAQH,GAAR,IAAe,IAAI5B,YAAYC,IAAhB,CAAqBoB,IAAIE,IAAJ,CAAS,aAAT,EAAwByC,GAAxB,CAA4B,CAA5B,CAArB,EAAqD;AACnE9D,WAAQ,WAD2D;AAEnEC,aAAU;AAFyD,GAArD,CAAf;AAIA4B,UAAQH,GAAR,EAAaxB,GAAb,CAAiB,CAAjB;AACA,EARD;;AAUAQ,GAAE,eAAF,EAAmBe,EAAnB,CAAsB,YAAtB,EAAoC,YAAW;AAC9C,MAAIC,MAAMhB,EAAE,IAAF,EAAQY,IAAR,CAAa,KAAb,CAAV;AACAK,UAAQC,GAAR,CAAY,YAAZ,EAA0BF,GAA1B;AACAG,UAAQH,GAAR,EAAanB,OAAb,CAAqB,CAArB;AACA;AACA,EALD;;AAOAG,GAAE,eAAF,EAAmBe,EAAnB,CAAsB,YAAtB,EAAoC,UAACK,KAAD,EAAW;AAC9C,MAAIJ,MAAMhB,EAAEoB,MAAMC,aAAR,EAAuBT,IAAvB,CAA4B,KAA5B,CAAV;AACAO,UAAQH,GAAR,EAAaxB,GAAb,CAAiB,CAAjB;AACA;AACA,EAJD;;AAMAQ,GAAE,gBAAF,EAAoBe,EAApB,CAAuB,OAAvB,EAAgC,UAACK,KAAD,EAAW;AAC1CI,QAAMU,IAAN;AACAd,QAAMiC,eAAN;AACA,EAHD;;AAKArD,GAAE,gBAAF,EAAoBe,EAApB,CAAuB,OAAvB,EAAgC,UAACK,KAAD,EAAW;AAC1CI,QAAMI,IAAN;AACAR,QAAMiC,eAAN;AACA,EAHD;;AAKArD,GAAE,eAAF,EAAmBe,EAAnB,CAAsB,OAAtB,EAA+B,UAACK,KAAD,EAAW;AACzC,MAAIJ,MAAMhB,EAAEoB,MAAMC,aAAR,EAAuBT,IAAvB,CAA4B,KAA5B,CAAV;AACA0C,oBAAkBtC,GAAlB;AACA,EAHD;;AAKA,KAAIuC,UAAUvD,EAAE,aAAF,CAAd;AACA,KAAIwD,YAAYD,QAAQE,OAAR,CAAgB,KAAhB,CAAhB;AACAzD,GAAE,QAAF,EAAYe,EAAZ,CAAe,OAAf,EAAwB,YAAM;AAC7B,MAAGgC,SAAH,EAAc;AACbF,SAAMa,KAAN;AACAH,WAAQd,IAAR;AACAe,aAAU5C,IAAV,CAAe,OAAf,EAAwB,KAAxB;AACA,GAJD,MAIO;AACNiC,SAAMc,IAAN;AACAJ,WAAQjD,IAAR;AACAkD,aAAU5C,IAAV,CAAe,OAAf,EAAwB,EAAxB;AACA;AACDmC,cAAY,CAACA,SAAb;AACA,EAXD;;AAaAxC;AACA,CAxDD;;AA0DA;AACA;AACA;;AAEA,IAAIgC,eAAJ;AAAA,IAAYiB,kBAAZ;AAAA,IAAuBI,cAAvB;AAAA,IAA8BC,iBAA9B;AAAA,IAAwCC,cAAxC;AAAA,IAA+CC,cAA/C;AAAA,IAAsDC,uBAAtD;AAAA,IAAsEC,UAAtE;AAAA,IAAyE1C,gBAAzE;AAAA,IAAkF2C,aAAlF;AAAA,IAAwFC,gBAAxF;AAAA,IAAiGC,qBAAjG;AAAA,IAA+GC,iBAA/G;AAAA,IAAyHC,oBAAzH;AAAA,IAAsIC,eAAtI;AAAA,IAA8IC,aAA9I;AAAA,IAAoJC,YAAY,EAAhK;AAAA,IAAoKC,cAApK;AAAA,IAA2KC,iBAA3K;AAAA,IAAqLC,UAAU,EAA/L;AAAA,IAAmMC,mBAAnM;AAAA,IAA+MC,kBAA/M;AAAA,IAA0NC,yBAA1N;AAAA,IAA4OC,cAAc,KAA1P;AAAA,IAAiQC,qBAAjQ;AAAA,IAA+QC,kBAA/Q;AAAA,IAA0RC,iBAA1R;AAAA,IAAoSC,cAApS;AAAA,IAA2SC,aAA3S;AAAA,IAAiTC,iBAAiB,EAAlU;AAAA,IAAsUC,kBAAtU;AAAA,IAAiVC,wBAAjV;AAAA,IAAkWC,eAAlW;AAAA,IAA0WC,cAA1W;AACA,IAAIC,QAAQ,KAAZ;AACA,IAAIC,cAAc,EAAlB;AACA,IAAIC,cAAc,IAAlB;AACA,IAAIC,WAAW,EAAf;AACA,IAAIC,iBAAiB,CACpB;AACCC,KAAI,CADL;AAECjE,SAAQ,CACP;AACCE,SAAO;AADR,EADO,EAIP;AACCA,SAAO;AADR,EAJO,EAOP;AACCA,SAAO;AADR,EAPO,EAUP;AACCA,SAAO;AADR,EAVO,CAFT;AAgBCtD,MAAK,EAhBN;AAiBCD,WAAU,CAAC,GAAD,EAAM,CAAN,EAAS,GAAT;AAjBX,CADoB,EAoBpB;AACCsH,KAAI,CADL;AAECrH,MAAK,EAFN;AAGCoD,SAAQ,CACP;AACCE,SAAO;AADR,EADO,EAIP;AACCA,SAAO;AADR,EAJO,EAOP;AACCA,SAAO;AADR,EAPO,EAUP;AACCA,SAAO;AADR,EAVO,CAHT;AAiBCvD,WAAU,CAAC,GAAD,EAAM,CAAN,EAAS,GAAT;AAjBX,CApBoB,EAuCpB;AACCsH,KAAI,CADL;AAECrH,MAAK,IAFN;AAGCoD,SAAQ,CACP;AACCE,SAAO;AADR,EADO,EAIP;AACCA,SAAO;AADR,EAJO,EAOP;AACCA,SAAO;AADR,EAPO,EAUP;AACCA,SAAO;AADR,EAVO,CAHT;AAiBCvD,WAAU,CAAC,EAAD,EAAK,CAAL,EAAQ,GAAR;AAjBX,CAvCoB,EA0DpB;AACCsH,KAAI,CADL;AAECrH,MAAK,GAFN;AAGCoD,SAAQ,CACP;AACCE,SAAO;AADR,EADO,EAIP;AACCA,SAAO;AADR,EAJO,EAOP;AACCA,SAAO;AADR,EAPO,EAUP;AACCA,SAAO;AADR,EAVO,CAHT;AAiBCvD,WAAU,CAAC,CAAC,GAAF,EAAO,CAAP,EAAU,GAAV;AAjBX,CA1DoB,EA6EpB;AACCsH,KAAI,CADL;AAECrH,MAAK,GAFN;AAGCoD,SAAQ,CACP;AACCE,SAAO;AADR,EADO,EAIP;AACCA,SAAO;AADR,EAJO,EAOP;AACCA,SAAO;AADR,EAPO,EAUP;AACCA,SAAO;AADR,EAVO,CAHT;AAiBCvD,WAAU,CAAC,CAAC,GAAF,EAAO,CAAP,EAAU,GAAV;AAjBX,CA7EoB,EAgGpB;AACCsH,KAAI,CADL;AAECrH,MAAK,GAFN;AAGCoD,SAAQ,CACP;AACCE,SAAO;AADR,EADO,EAIP;AACCA,SAAO;AADR,EAJO,EAOP;AACCA,SAAO;AADR,EAPO,EAUP;AACCA,SAAO;AADR,EAVO,CAHT;AAiBCvD,WAAU,CAAC,CAAC,GAAF,EAAO,CAAP,EAAU,EAAV;AAjBX,CAhGoB,EAmHpB;AACCsH,KAAI,CADL;AAECrH,MAAK,GAFN;AAGCoD,SAAQ,CACP;AACCE,SAAO;AADR,EADO,EAIP;AACCA,SAAO;AADR,EAJO,EAOP;AACCA,SAAO;AADR,EAPO,EAUP;AACCA,SAAO;AADR,EAVO,CAHT;AAiBCvD,WAAU,CAAC,CAAC,GAAF,EAAO,CAAP,EAAU,CAAC,GAAX;AAjBX,CAnHoB,EAsIpB;AACCsH,KAAI,CADL;AAECrH,MAAK,KAFN;AAGCoD,SAAQ,CACP;AACCE,SAAO;AADR,EADO,EAIP;AACCA,SAAO;AADR,EAJO,EAOP;AACCA,SAAO;AADR,EAPO,EAUP;AACCA,SAAO;AADR,EAVO,CAHT;AAiBCvD,WAAU,CAAC,CAAC,EAAF,EAAM,CAAN,EAAS,CAAC,GAAV;AAjBX,CAtIoB,EAyJpB;AACCsH,KAAI,CADL;AAECrH,MAAK,KAFN;AAGCoD,SAAQ,CACP;AACCE,SAAO;AADR,EADO,EAIP;AACCA,SAAO;AADR,EAJO,EAOP;AACCA,SAAO;AADR,EAPO,EAUP;AACCA,SAAO;AADR,EAVO,CAHT;AAiBCvD,WAAU,CAAC,GAAD,EAAM,CAAN,EAAS,CAAC,GAAV;AAjBX,CAzJoB,EA4KpB;AACCsH,KAAI,CADL;AAECrH,MAAK,GAFN;AAGCoD,SAAQ,CACP;AACCE,SAAO;AADR,EADO,EAIP;AACCA,SAAO;AADR,EAJO,EAOP;AACCA,SAAO;AADR,EAPO,EAUP;AACCA,SAAO;AADR,EAVO,CAHT;AAiBCvD,WAAU,CAAC,GAAD,EAAM,CAAN,EAAS,CAAC,GAAV;AAjBX,CA5KoB,CAArB;AAgMA,IAAIuH,oBAAoB,CAAxB;AAAA,IAA2BC,oBAAoB,CAA/C;AAAA,IACAC,iBAAiB,CADjB;AAAA,IAEAC,MAAM,CAFN;AAAA,IAESC,iBAAiB,CAF1B;AAAA,IAGAC,MAAM,CAHN;AAAA,IAGSC,QAAQ,CAHjB;;AAKA/C,YAAYR,SAASwD,cAAT,CAAyB,WAAzB,CAAZ;;AAEA,IAAIC,iBAAiBjD,UAAUkD,WAA/B;AACA,IAAIC,kBAAkBnD,UAAUoD,YAAhC;;AAEA,IAAIC,kBAAkB,EAAtB;AACA,IAAIC,eAAJ;AACA,IAAIC,mBAAJ;AACA,IAAIC,oBAAJ;AACA,IAAIC,iBAAJ;AACA,IAAIC,mBAAJ;AACA;AACA,IAAI5E,eAAe,KAAnB;AACA,IAAI6E,2BAAJ;AACA,IAAIC,oBAAoB,KAAxB;;AAEA,IAAIC,YAAY,IAAIC,MAAMC,SAAV,EAAhB;AACA,IAAIC,cAAc,IAAIF,MAAMG,OAAV,EAAlB;;AAEA,IAAIC,uBAAJ;;AAEA,IAAIC,oBAAJ;AACA,IAAK,kBAAkBC,MAAnB,IAA8BA,OAAOC,aAAP,IAAwB7E,oBAAoB6E,aAA9E,EAA6F;AAC5FF,eAAc,IAAd;AACA;;AAEDG;AACAjI;;AAEA;AACA;AACA;;AAEA,SAASiI,IAAT,GAAgB;;AAEf,KAAIC,QAAQH,OAAOI,UAAP,IAAqB,CAAjC;AACA,KAAIC,SAASL,OAAOM,WAAP,IAAsB,CAAnC;AACA,KAAIC,mBAAmBP,OAAOO,gBAAP,IAA2B,CAAlD;AACAhD,YAAW,IAAImC,MAAMc,aAAV,CAAyB,EAAEC,WAAW,KAAb,EAAzB,CAAX;AACAlD,UAASmD,SAAT,CAAmBC,OAAnB,GAA6B,IAA7B;AACApD,UAASqD,aAAT,CAAwB,QAAxB;AACArD,UAASsD,aAAT,CAAwB,CAAxB;AACAtD,UAASuD,OAAT,CAAkBX,KAAlB,EAAyBE,MAAzB;;AAEA1F,UAAS,IAAI+E,MAAMqB,iBAAV,CAA6B,EAA7B,EAAiCf,OAAOI,UAAP,GAAoBJ,OAAOM,WAA5D,EAAyE,CAAzE,EAA4E,IAA5E,CAAT;AACA3F,QAAOqG,MAAP,GAAgB,IAAItB,MAAMG,OAAV,CAAmB,CAAnB,EAAsB,CAAtB,EAAyB,CAAzB,CAAhB;AACArC,SAAQ,IAAIkC,MAAMuB,KAAV,EAAR;;AAEA,KAAIC,WAAW,IAAIxB,MAAMyB,cAAV,CAA0B,GAA1B,EAA+B,EAA/B,EAAmC,GAAnC,CAAf;AACAD,UAASE,KAAT,CAAgB,CAAE,CAAlB,EAAqB,CAArB,EAAwB,CAAxB;;AAEA,KAAIC,WAAW,IAAI3B,MAAM4B,iBAAV,CAA6B;AAC3CC,OAAK,IAAI7B,MAAM8B,aAAV,GAA0BC,IAA1B,CAAgC,oCAAhC,CADsC;AAE3CC,OAAK;AAFsC,EAA7B,CAAf;;AAKA9E,QAAO,IAAI8C,MAAMiC,IAAV,CAAgBT,QAAhB,EAA0BG,QAA1B,CAAP;AACAzE,MAAKgF,IAAL,GAAY,OAAZ;AACApE,OAAMqE,GAAN,CAAWjF,IAAX;;AAEAkB,SAAQgE,WAAR;;AAEAxE,aAAY,IAAIoC,MAAMqC,SAAV,EAAZ;AACAjF,SAAQ,IAAI4C,MAAMsC,OAAV,EAAR;;AAEA;AACAC;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA/F,SAAQ,IAAIwD,MAAMwC,KAAV,EAAR;;AAEA;AACA7C,YAAW,IAAIK,MAAMyC,cAAV,CAA0B5E,QAA1B,CAAX;AACA4B,cAAa,IAAIO,MAAM0C,UAAV,CAAsB5E,KAAtB,EAA6B7C,MAA7B,CAAb;AACA0E,UAASgD,OAAT,CAAkBlD,UAAlB;AACAC,eAAc,IAAIM,MAAM4C,WAAV,CAAuB,IAAI5C,MAAMsC,OAAV,CAAkBhC,OAAOI,UAAzB,EAAqCJ,OAAOM,WAA5C,CAAvB,EAAiF9C,KAAjF,EAAwF7C,MAAxF,CAAd;;AAEAyE,aAAYmD,YAAZ,GAA2B,GAA3B;AACAnD,aAAYoD,QAAZ,GAAuB,GAAvB;AACApD,aAAYqD,aAAZ,GAA4B,GAA5B;AACArD,aAAYsD,WAAZ,GAA0B,GAA1B;AACAtD,aAAYuD,gBAAZ,GAA+B,EAACC,GAAG,GAAJ,EAASC,GAAG,GAAZ,EAAiBC,GAAG,GAApB,EAA/B;;AAEAzD,UAASgD,OAAT,CAAkBjD,WAAlB;AACA;AACA,KAAI2D,SAAS,SAATA,MAAS,CAASC,OAAT,EAAkB;AAC9B5D,cAAY6D,cAAZ,GAA6BD,OAA7B;AACAA,UAAQE,KAAR,GAAgBxD,MAAMyD,cAAtB;AACAH,UAAQI,KAAR,GAAgB1D,MAAMyD,cAAtB;AACA,EAJD;AAKA,KAAIE,MAAM,IAAI3D,MAAM8B,aAAV,EAAV;AACA6B,KAAI5B,IAAJ;AACC;AACA,2BAFD;AAGC;AACAsB,OAJD;;AAOAzD,cAAa,IAAII,MAAM4D,UAAV,CAAqB5D,MAAM6D,UAA3B,CAAb;AACAjE,YAAWkE,QAAX,CAAoB,YAApB,EAAkCC,KAAlC,CAAwC7L,GAAxC,CAA4C,IAAIoI,OAAOI,UAAvD,EAAmE,IAAIJ,OAAOM,WAA9E;AACAhB,YAAWoE,cAAX,GAA4B,IAA5B;AACArE,UAASgD,OAAT,CAAkB/C,UAAlB;;AAEA1D,WAAU+H,WAAV,CAAuBpG,SAASqG,UAAhC;AACA;;;AAGA;AACA;AACA;AACA;;AAEAxI,UAASyI,gBAAT,CAA0B,WAA1B,EAAuCC,mBAAvC,EAA4D,KAA5D;AACA1I,UAASyI,gBAAT,CAA0B,WAA1B,EAAuCE,mBAAvC,EAA4D,KAA5D;AACA3I,UAASyI,gBAAT,CAA0B,SAA1B,EAAqCG,iBAArC,EAAwD,KAAxD;;AAEA5I,UAASyI,gBAAT,CAA2B,YAA3B,EAAyCI,oBAAzC,EAA+D,KAA/D;AACA;AACAjE,QAAO6D,gBAAP,CAAyB,QAAzB,EAAmCK,cAAnC,EAAmD,KAAnD;;AAEAC;AACA;AACAC;;AAEAhJ,UAASiJ,IAAT,CAAcV,WAAd,CAA2BpG,SAASqG,UAApC;AAEA;;AAED,SAASU,YAAT,GAAwB;AACvB,KAAIC,SAAJ;AAAA,KACCC,KADD;AAAA,KAEIC,KAAS,KAFb;AAAA,KAEqB;AACjBC,UAAS,oBAHb;AAAA,KAIIC,SAAS,SAATA,MAAS,CAAUC,CAAV,EAAa;AAAE,SAAOC,mBAAmBD,EAAEE,OAAF,CAAUL,EAAV,EAAc,GAAd,CAAnB,CAAP;AAAgD,EAJ5E;AAAA,KAKIM,QAAS/E,OAAOgF,QAAP,CAAgBN,MAAhB,CAAuBO,SAAvB,CAAiC,CAAjC,CALb;;AAOAV,aAAY,EAAZ;AACA,QAAOC,QAAQE,OAAOQ,IAAP,CAAYH,KAAZ,CAAf;AACGR,YAAUI,OAAOH,MAAM,CAAN,CAAP,CAAV,IAA8BG,OAAOH,MAAM,CAAN,CAAP,CAA9B;AADH,EAEA,OAAOD,SAAP;AACA;;AAED,SAASH,YAAT,GAAwB;AACvB,KAAIG,YAAYD,cAAhB;AACA,KAAGC,UAAUnG,EAAb,EAAiB;AAAA;AAChB,OAAIA,KAAK+G,SAASZ,UAAUnG,EAAnB,CAAT;AACA,OAAIzE,UAAUwE,eAAeiH,MAAf,CAAuB;AAAA,WAAWhH,OAAOzE,QAAQyE,EAA1B;AAAA,IAAvB,CAAd;AACA,OAAGzE,OAAH,EAAY;AACXA,cAAUA,QAAQ,CAAR,CAAV;AACA4F,yBAAqB5F,QAAQ5C,GAA7B;AACA+I,qBAAiBnG,OAAjB;AACAC,UAAMiB,IAAN,CAAWlB,OAAX;AACA;AARe;AAShB;AACD;;AAED,IAAI0L,eAAe;AAClB,YADkB,sBACJ;AACbhM,UAAQC,GAAR,CAAY,UAAZ;AACA,EAHiB;AAIlBgM,GAJkB,gBAIb;AACJjM,UAAQC,GAAR,CAAY,SAAZ;AACA;AANiB,CAAnB;AAQA,SAASoC,iBAAT,CAA2BtC,GAA3B,EAAgC;AAC/B,KAAGA,OAAOiM,YAAV,EAAwBA,aAAajM,GAAb;AACxB;;AAED,SAAS6I,aAAT,GAAyB;AACxB/C,UAAS,IAAIQ,MAAM6F,UAAV,EAAT;AACArG,QAAOuC,IAAP,CAAY,oBAAZ,EAAkC,UAASP,QAAT,EAAmB;AACrD;AACA;AACChD,aAAWC,eAAeoD,GAAf,CAAoB,UAACiE,aAAD,EAAgBlK,KAAhB,EAA0B;AACxD4F,YAASuE,MAAT;;AAEA;AACA;;AAEA,OAAIrE,QAAQ,EAAZ;;AAEA;AACA;AACA;AACA;AACA;;AAEA,OAAIsE,SAAS,IAAIhG,MAAM4B,iBAAV,CAA6B,EAAEtF,OAAO,SAAT,EAAoB2J,SAAS,CAA7B,EAA7B,CAAb;;AAEA,OAAIhM,UAAU,IAAI+F,MAAMiC,IAAV,CAAeT,QAAf,EAAyBwE,MAAzB,CAAd;AACA/L,WAAQiI,IAAR,gBAA0BtG,KAA1B;AACA,OAAIsK,MAAM,IAAIlG,MAAMmG,IAAV,GAAiBC,aAAjB,CAA+BnM,OAA/B,CAAV;AACAA,WAAQyH,KAAR,CAAc2E,CAAd,GAAkBpM,QAAQyH,KAAR,CAAc4E,CAAd,GAAkBrM,QAAQyH,KAAR,CAAc6E,CAAd,GAAkB7E,KAAtD;AACAzH,WAAQuM,QAAR,CAAiBH,CAAjB,GAAqB,KAAGI,KAAKC,EAA7B;AACAzM,WAAQA,OAAR,GAAkB6L,aAAlB;;AAEA,OAAIa,YAAY,IAAI3G,MAAM4G,iBAAV,CAA6BV,IAAIW,OAAJ,GAAcR,CAAd,GAAkB3E,KAAlB,GAA0B,GAAvD,EAA4DwE,IAAIW,OAAJ,GAAcR,CAAd,GAAkB3E,KAAlB,GAA0B,GAAtF,EAA4FwE,IAAIW,OAAJ,GAAcR,CAAd,GAAkB3E,KAAlB,GAA0B,GAAtH,CAAhB;AACA,OAAIoF,YAAY,IAAI9G,MAAM4B,iBAAV,CAA4B,EAAEmF,SAAS,KAAX,EAA5B,CAAhB;AACA;AACA;AACA,OAAIC,aAAa,IAAIhH,MAAMiC,IAAV,CAAgB0E,SAAhB,EAA2BG,SAA3B,CAAjB;AACAE,cAAW9E,IAAX,eAA4BtG,KAA5B;;AAEA,OAAIqL,kBAAkBnB,cAAc1O,QAApC;;AAEA,OAAI8P,QAAQ,IAAIlH,MAAMmH,KAAV,EAAZ;AACAD,SAAMhF,IAAN,cAAsBtG,KAAtB;AACAsL,SAAM9P,QAAN,CAAec,GAAf,CAAmB+O,gBAAgB,CAAhB,CAAnB,EAAuCA,gBAAgB,CAAhB,CAAvC,EAA2DA,gBAAgB,CAAhB,CAA3D;AACAnJ,SAAMqE,GAAN,CAAU+E,KAAV;AACAA,SAAM/E,GAAN,CAAUlI,OAAV;AACAiN,SAAM/E,GAAN,CAAU6E,UAAV;;AAEA,UAAOE,KAAP;AAEA,GAzCU,CAAX;AA0CA,EA7CD;AA8CA;;AAED,SAASE,UAAT,GAAsB;AACrB;AACA,KAAIC,QAAQ,IAAIrH,MAAMsH,gBAAV,CAA2B,QAA3B,EAAqC,GAArC,CAAZ;AACAD,OAAMjQ,QAAN,CAAec,GAAf,CAAmB,CAAC,CAApB,EAAuB,CAAvB,EAA0B,CAA1B;AACA4F,OAAMqE,GAAN,CAAUkF,KAAV;;AAEA,KAAIE,mBAAmB,IAAIvH,MAAMsH,gBAAV,CAA2B,QAA3B,CAAvB;AACAC,kBAAiBnQ,QAAjB,CAA0Bc,GAA1B,CAA8B,CAA9B,EAAiC,CAAjC,EAAoC,CAApC,EAAuCsP,SAAvC;AACA1J,OAAMqE,GAAN,CAAUoF,gBAAV;;AAEA,KAAIE,eAAezH,MAAM0H,UAAN,CAAiBC,WAAjB,CAA6B,sEAA7B,CAAnB;AACA,KAAIC,gBAAgB,IAAI5H,MAAM6H,mBAAV,CAA8B;AACjDvL,SAAO,QAD0C;AAEjDuF,OAAK4F,YAF4C;AAGjDK,eAAa;AAHoC,EAA9B,CAApB;AAKA,KAAIC,WAAW,IAAI/H,MAAMgI,aAAV,CAAwB,GAAxB,EAA6B,GAA7B,CAAf;;AAEA,MAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAI,GAApB,EAAyBA,GAAzB,EAA8B;AAC7B,MAAIC,WAAW,IAAIlI,MAAMiC,IAAV,CAAe8F,QAAf,EAAwBH,aAAxB,CAAf;AACAM,WAAS9Q,QAAT,CAAkBc,GAAlB,CAAsBuO,KAAK0B,MAAL,KAAc,GAAd,GAAkB,GAAxC,EAA4C1B,KAAK0B,MAAL,KAAc,GAAd,GAAkB,GAA9D,EAAkE1B,KAAK0B,MAAL,KAAc,IAAd,GAAmB,GAArF;AACAD,WAAS1B,QAAT,CAAkBD,CAAlB,GAAsBE,KAAK0B,MAAL,KAAgB,GAAtC;AACArK,QAAMqE,GAAN,CAAU+F,QAAV;AACAlK,iBAAeoK,IAAf,CAAoBF,QAApB;AACA;AACD;;AAGD,SAASG,WAAT,GAAuB;AACtB,KAAIC,KAAKtK,eAAetD,MAAxB;AACA,QAAM4N,IAAN,EAAY;AACXtK,iBAAesK,EAAf,EAAmB9B,QAAnB,CAA4BD,CAA5B,IAAkC9J,QAAQ,GAA1C;AACA;AACD;;AAED,SAASgI,QAAT,GAAoB;AACnB9G,gBAAe,IAAIqC,MAAMuI,QAAV,EAAf;;AAEA,KAAIC,UAAUxI,MAAM0H,UAAN,CAAiBC,WAAjB,CAA8B,oBAA9B,CAAd;AAAA,KACAc,UAAUzI,MAAM0H,UAAN,CAAiBC,WAAjB,CAA8B,oBAA9B,CADV;AAAA,KAEAe,UAAU1I,MAAM0H,UAAN,CAAiBC,WAAjB,CAA8B,oBAA9B,CAFV;AAAA,KAGAgB,UAAU3I,MAAM0H,UAAN,CAAiBC,WAAjB,CAA8B,oBAA9B,CAHV;AAAA,KAIAiB,UAAU5I,MAAM0H,UAAN,CAAiBC,WAAjB,CAA8B,oBAA9B,CAJV;;AAMA,MAAK,IAAI5M,IAAI,CAAb,EAAgBA,IAAI2C,WAApB,EAAiC3C,GAAjC,EAAuC;AACtC,MAAI8N,SAAS,IAAI7I,MAAMG,OAAV,EAAb;AACA0I,SAAOxC,CAAP,GAAWI,KAAK0B,MAAL,KAAgB,IAAhB,GAAuB,IAAlC;AACAU,SAAOvC,CAAP,GAAWG,KAAK0B,MAAL,KAAgB,IAAhB,GAAuB,GAAlC;AACAU,SAAOtC,CAAP,GAAWE,KAAK0B,MAAL,KAAgB,IAAhB,GAAuB,IAAlC;;AAEAxK,eAAamL,QAAb,CAAsBV,IAAtB,CAA4BS,MAA5B;AACA;;AAEDtL,cAAa,CAAE,CAAE,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,CAAF,EAAoBkL,OAApB,EAA6B,EAA7B,CAAF,EACP,CAAE,CAAC,IAAD,EAAO,GAAP,EAAY,GAAZ,CAAF,EAAqBC,OAArB,EAA8B,EAA9B,CADO,EAEP,CAAE,CAAC,IAAD,EAAO,IAAP,EAAa,GAAb,CAAF,EAAqBF,OAArB,EAA8B,EAA9B,CAFO,EAGP,CAAE,CAAC,IAAD,EAAO,CAAP,EAAU,GAAV,CAAF,EAAmBI,OAAnB,EAA4B,CAA5B,CAHO,EAIP,CAAE,CAAC,IAAD,EAAO,CAAP,EAAU,GAAV,CAAF,EAAmBD,OAAnB,EAA4B,CAA5B,CAJO,CAAb;;AAOA,MAAK,IAAI5N,KAAI,CAAb,EAAgBA,KAAIwC,WAAW7C,MAA/B,EAAuCK,IAAvC,EAA6C;;AAE5CuB,UAASiB,WAAWxC,EAAX,EAAc,CAAd,CAAT;AACAoD,WAASZ,WAAWxC,EAAX,EAAc,CAAd,CAAT;AACAgD,SAASR,WAAWxC,EAAX,EAAc,CAAd,CAAT;;AAEAoC,YAAUpC,EAAV,IAAe,IAAIiF,MAAM+I,kBAAV,CAA6B;AAC3ChL,SAAMA,IADqC;AAE3C8D,QAAK1D,MAFsC;AAG3C6K,aAAUhJ,MAAMiJ,gBAH2B;AAI3CC,cAAW,KAJgC;AAK3CpB,gBAAc;AAL6B,GAA7B,CAAf;AAOA3K,YAAUpC,EAAV,EAAauB,KAAb,CAAmB6M,MAAnB,CAA2B7M,MAAM,CAAN,CAA3B,EAAqCA,MAAM,CAAN,CAArC,EAA+CA,MAAM,CAAN,CAA/C;;AAEAkB,cAAY,IAAIwC,MAAMoJ,UAAV,CAAsBzL,YAAtB,EAAoCR,UAAUpC,EAAV,CAApC,CAAZ;;AAEAyC,YAAUgJ,QAAV,CAAmBD,CAAnB,GAAuBE,KAAK0B,MAAL,KAAgB,IAAhB,GAAuB,IAA9C;;AAEArK,QAAMqE,GAAN,CAAW3E,SAAX;AACA;AACD;;AAED,SAAS6L,WAAT,GAAuB;AACtB;AACA,KAAIC,OAAOC,KAAKC,GAAL,KAAa,OAAxB;;AAEA,MAAK,IAAIzO,IAAI,CAAb,EAAgBA,IAAI+C,MAAM2L,QAAN,CAAe/O,MAAnC,EAA2CK,GAA3C,EAAiD;;AAEhD,MAAI2O,SAAS5L,MAAM2L,QAAN,CAAe1O,CAAf,CAAb;;AAEA,MAAK2O,kBAAkB1J,MAAMoJ,UAA7B,EAA0C;AACzC;AACAzP,WAAQC,GAAR,CAAY,sBAAZ;AACA,OAAImB,KAAK,CAAT,EAAY;AACX2O,WAAOC,UAAP,CAAkB,CAAC,EAAnB;AACA;;AAED,OAAI5O,IAAI,CAAR,EAAW;AACV,QAAIsD,KAAJ,EACCqL,OAAOC,UAAP,CAAkB,CAAC,EAAnB,EADD,KAGC,IAAG7L,MAAM2L,QAAN,CAAe1O,IAAE,CAAjB,EAAoB3D,QAApB,CAA6BkP,CAA7B,GAAmChG,OAAOM,WAAP,GAAqB,CAAC,CAAvB,GAA4B,CAA5B,GAAgC,IAArE,EACC8I,OAAOC,UAAP,CAAkB,CAAC,EAAnB;AACF;;AAED,OAAKD,OAAOtS,QAAP,CAAgBkP,CAAhB,GAAoBhG,OAAOM,WAAP,GAAqB,CAAC,CAAtB,GAA0B,CAAnD,EAAuD;AACrD8I,WAAOtS,QAAP,CAAgBkP,CAAhB,GAAoB,GAApB;AACAoD,WAAOtS,QAAP,CAAgBiP,CAAhB,GAAoB,CAApB;AACA,QAAItL,KAAK,CAAT,EAAYsD,QAAQ,IAAR;AACb;AACD;AACD;;AAED,MAAK,IAAItD,MAAI,CAAb,EAAgBA,MAAIoC,UAAUzC,MAA9B,EAAsCK,KAAtC,EAA4C;;AAE3CuB,UAAQiB,WAAWxC,GAAX,EAAc,CAAd,CAAR;;AAEA4B,MAAM,OAAQL,MAAM,CAAN,IAAWgN,IAAnB,IAA4B,GAA9B,GAAsC,GAA1C;AACAnM,YAAUpC,GAAV,EAAauB,KAAb,CAAmB6M,MAAnB,CAA2BxM,CAA3B,EAA8BL,MAAM,CAAN,CAA9B,EAAwCA,MAAM,CAAN,CAAxC;AAEA;AACD;;AAED,SAASkI,cAAT,GAA0B;AACzB,KAAI/D,QAAQH,OAAOI,UAAP,IAAqB,CAAjC;AACA,KAAIC,SAASL,OAAOM,WAAP,IAAsB,CAAnC;AACA,KAAIC,mBAAmBP,OAAOO,gBAAP,IAA2B,CAAlD;AACA5F,QAAO2O,MAAP,GAAgBnJ,QAAQE,MAAxB;AACA1F,QAAO4O,sBAAP;AACAhM,UAASuD,OAAT,CAAkBX,KAAlB,EAAyBE,MAAzB;AACAhB,UAASyB,OAAT,CAAkBX,KAAlB,EAAyBE,MAAzB;AACAf,YAAWkE,QAAX,CAAoB,YAApB,EAAkCC,KAAlC,CAAwC7L,GAAxC,CAA4C,IAAIoI,OAAOI,UAAvD,EAAmE,IAAIJ,OAAOM,WAA9E;AACA;;AAED,SAAS2D,oBAAT,CAA+BzK,KAA/B,EAAuC;AACtCA,OAAMgQ,cAAN;AACAhQ,OAAMiQ,OAAN,GAAgBjQ,MAAMkQ,OAAN,CAAc,CAAd,EAAiBD,OAAjC;AACAjQ,OAAMmQ,OAAN,GAAgBnQ,MAAMkQ,OAAN,CAAc,CAAd,EAAiBC,OAAjC;AACA7F,qBAAqBtK,KAArB;AACA;;AAED,SAASoQ,iBAAT,CAA2BR,MAA3B,EAAmC;AAClCnK,mBAAkB,EAAlB;AACAA,iBAAgB6I,IAAhB,CAAqBsB,MAArB;AACA;;AAED,SAASS,wBAAT,CAAkCrQ,KAAlC,EAAyC;;AAExC,KAAIsQ,UAAU,IAAIpK,MAAMG,OAAV,CAAqBrG,MAAMiQ,OAAN,GAAgBzJ,OAAOI,UAAzB,GAAwC,CAAxC,GAA4C,CAA/D,EACN,EAAG5G,MAAMmQ,OAAN,GAAgB3J,OAAOM,WAA1B,IAA0C,CAA1C,GAA8C,CADxC,EAEN,GAFM,CAAd;AAGAhD,WAAUyM,aAAV,CAAyBD,OAAzB,EAAkCnP,MAAlC;AACA,KAAIqP,aAAa1M,UAAU2M,gBAAV,CAA2BzM,MAAM2L,QAAjC,EAA2C,IAA3C,CAAjB;AACA,KAAIe,QAAQF,WAAW5E,MAAX,CAAmB;AAAA,SAAa+E,UAAUf,MAAV,CAAiBxH,IAAjB,CAAsB4C,KAAtB,CAA4B,QAA5B,CAAb;AAAA,EAAnB,CAAZ;AACA,KAAG0F,MAAM9P,MAAT,EAAiB;AAChB8P,QAAME,OAAN,CAAc,UAACvQ,IAAD,EAAU;AACvB,OAAImH,SAASnH,KAAKuP,MAAL,CAAYiB,MAAZ,CAAmBlB,QAAnB,CAA4B,CAA5B,CAAb;AACA,OAAGlK,gBAAgBqL,OAAhB,CAAwBtJ,MAAxB,MAAoC,CAAC,CAAxC,EAA2C;AAC1C5I,MAAE,MAAF,EAAUmS,QAAV,CAAmB,KAAnB;AACAX,sBAAkB5I,MAAlB;AACA;AACD,GAND;AAOA,EARD,MAQO;AACN5I,IAAE,MAAF,EAAUoS,WAAV,CAAsB,KAAtB;AACAvL,oBAAkB,EAAlB;AACA;AACDG,aAAYH,eAAZ,GAA8BA,eAA9B;AACA;;AAED;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA,SAASjE,UAAT,CAAoBrB,OAApB,EAA6B;;AAE5BvB,GAAE,kBAAF,EAAsBqS,GAAtB,CAA0B,EAACC,KAAK,CAAN,EAA1B;AACAtS,GAAE,yBAAF,EAA6Be,EAA7B,CAAgC,OAAhC,EAAyCS,MAAMlB,IAA/C;;AAEAN,GAAE,UAAF,EAAce,EAAd,CAAiB,OAAjB,EAA0BS,MAAMlB,IAAhC;AACAN,GAAEgD,QAAF,EAAYjC,EAAZ,CAAe,SAAf,EAA0B,UAACK,KAAD,EAAW;AACpC,MAAGA,MAAMmR,OAAN,KAAkB,EAArB,EAAyB;AACxB/Q,SAAMlB,IAAN;AACA;AACD,EAJD;;AAMA;AACA;AACA;AACA;AACA;AACA;;AAED,SAASkS,aAAT,CAAuBxM,EAAvB,EAA2BtD,KAA3B,EAAkC;AACjC,KAAI+P,MAAM,EAAV;AACA,KAAGzM,OAAO0M,SAAP,IAAoB1M,OAAO,IAA9B,EAAoC;AACnCyM,kBAAczM,EAAd;AACA;AACD,KAAG,CAACtD,KAAJ,EAAWA,QAAQ,CAAR;AACX+P,oBAAiB/P,KAAjB;AACAzB,SAAQC,GAAR,CAAY,eAAZ,EAA6B8E,EAA7B,EAAiCtD,KAAjC,EAAwC+P,GAAxC;AACA,QAAOA,GAAP;AACA;;AAED,SAASE,QAAT,CAAkBC,KAAlB,EAAyBC,GAAzB,EAA8B;AAC7B,KAAIC,mBAAJ;AACA,KAAI/O,QAAQ6O,QAAMC,GAAlB;AACA,KAAIE,WAAWhF,KAAKiF,GAAL,CAASjP,KAAT,CAAf;AACA,KAAG6O,QAAQC,GAAX,EAAgB;AACfC,eAAaC,WAAW,GAAX,GAAiB,IAAjB,GAAwB,IAArC;AACA,EAFD,MAEO;AACND,eAAaC,WAAW,GAAX,GAAiB,IAAjB,GAAwB,IAArC;AACA;AACD,QAAO,EAAC1H,OAAO,MAAI0H,QAAJ,GAAeA,QAAf,GAA0B,MAAIA,QAA9B,GAAyCA,QAAjD,EAA2DD,YAAYA,UAAvE,EAAP;AACA;;AAED,SAASpH,mBAAT,CAA8BtK,KAA9B,EAAsC;AACrCgG,qBAAoB,IAApB;AACA,KAAGP,gBAAgB7E,MAAhB,IAA0B,CAACM,YAA9B,EAA4C;AAAA;AAC3C,OAAI2Q,KAAKpM,gBAAgB,CAAhB,EAAmBtF,OAA5B;AACA,OAAI2R,aAAaxU,SAASC,GAA1B;AACA,OAAIwU,aAAatM,gBAAgB,CAAhB,EAAmBtF,OAAnB,CAA2B5C,GAA5C;AACA,OAAIyU,OAAOT,SAASO,UAAT,EAAqBC,UAArB,CAAX;AACArT,YAASC,EAAT,CAAYrB,QAAZ,EAAsB,MAAI,IAA1B,EAAgC,EAACC,UAAQyU,KAAKN,UAAb,GAA0BM,KAAK/H,KAAhC,EAAyCxJ,YAAY,sBAAW;AAC/FnD,cAASC,GAAT,GAAeD,SAASC,GAAT,GAAa,GAA5B;AACAC,eAAUF,SAASC,GAAnB;AACA+I,sBAAiBuL,EAAjB;AACAzR,WAAMiB,IAAN,CAAWwQ,EAAX,EAAe,CAAf;AACA,KAL+B,EAAhC;AAL2C;AAW3C;AACD;;AAED,SAASI,cAAT,GAA0B;AACzBvN,UAASkM,OAAT,CAAkB;AAAA,SAAWzQ,QAAQwP,QAAR,CAAiB,CAAjB,EAAoBjD,QAApB,CAA6BD,CAA7B,IAAkChI,cAAc,GAA3D;AAAA,EAAlB;AACA;;AAED,SAAS8F,mBAAT,CAA8BvK,KAA9B,EAAsC;AACrCqQ,0BAAyBrQ,KAAzB;AACA,KAAGgG,qBAAqB,CAAC9E,YAAzB,EAAuC;AACtC,MAAIgR,YAAYlS,MAAMkS,SAAN,IAAmBlS,MAAMmS,YAAzB,IAAyCnS,MAAMoS,eAA/C,IAAkE,CAAlF;AACA,MAAIC,YAAYrS,MAAMqS,SAAN,IAAmBrS,MAAMsS,YAAzB,IAAyCtS,MAAMuS,eAA/C,IAAkE,CAAlF;AACA/U,aAAW0U,SAAX;AACA,MAAG1U,UAAU,CAAb,EAAgB;AACfA,aAAU,MAAMA,OAAhB;AACA;AACD,MAAGA,UAAU,GAAb,EAAkB;AACjBA,aAAU,CAAV;AACA;AACDF,WAASC,GAAT,GAAeC,OAAf;AACA;AACD;;AAED,SAASgN,iBAAT,CAA4BxK,KAA5B,EAAoC;AACnCgG,qBAAoB,KAApB;AACA;;AAED;AACA,SAASwM,oBAAT,CAA+BxS,KAA/B,EAAuC;AACtC,KAAImB,OAAOC,GAAP,GAAa,EAAjB,EAAqB;AACpBD,SAAOC,GAAP,GAAa,EAAb;AACA,EAFD,MAEO;AACND,SAAOC,GAAP,IAAcpB,MAAMyS,MAAN,GAAe,IAA7B;AACAtR,SAAO4O,sBAAP;AACA;AACD;AACA;AACA;;AAED,SAAStR,OAAT,GAAmB;AAClBiU,uBAAuBjU,OAAvB;AACAkU;AACA5O,UAASuD,OAAT,CAAkBd,OAAOI,UAAzB,EAAqCJ,OAAOM,WAA5C;AACA;;AAED,SAAS6L,MAAT,GAAkB;AACjB;AACA;AACA;AACA;AACA;AACA,KAAG5M,kBAAH,EAAuB;AACtBzI,WAASC,GAAT,GAAewI,kBAAf;AACAA,uBAAqB,IAArB;AACA;;AAEDf,OAAM2H,KAAKiG,GAAL,CAAU,CAAE,EAAZ,EAAgBjG,KAAKkG,GAAL,CAAU,EAAV,EAAc7N,GAAd,CAAhB,CAAN;AACAE,OAAMgB,MAAMyG,IAAN,CAAWmG,QAAX,CAAqB,KAAK9N,GAA1B,CAAN;AACAG,SAAQe,MAAMyG,IAAN,CAAWmG,QAAX,CAAqBxV,SAASC,GAA9B,CAAR;;AAEA4D,QAAOqG,MAAP,CAAc+E,CAAd,GAAkB,IAAII,KAAKoG,GAAL,CAAU7N,GAAV,CAAJ,GAAsByH,KAAKqG,GAAL,CAAU7N,KAAV,CAAxC;AACA;AACAhE,QAAOqG,MAAP,CAAciF,CAAd,GAAkB,IAAIE,KAAKoG,GAAL,CAAU7N,GAAV,CAAJ,GAAsByH,KAAKoG,GAAL,CAAU5N,KAAV,CAAxC;AACAhE,QAAO8R,MAAP,CAAe9R,OAAOqG,MAAtB;;AAEA;;;;AAIA;AACA;AACA;AACA;;AAEA;AACAlD,OAAMqO,MAAN;AACAhQ,SAAQD,MAAMwQ,QAAN,EAAR;;AAEA3E;AACA;AACA;AACA0D;;AAEA;;AAEA;AACA9M,UAAS,GAAT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACApB,UAASoP,MAAT,CAAiBnP,KAAjB,EAAwB7C,MAAxB;AACA;AACAA,QAAO4O,sBAAP;AACAlK,UAASsN,MAAT;AACA;AACA;AACA;AACA;;AAEDC,UAAUC,MAAV,CAAiBhJ,gBAAjB,CAAkC,MAAlC,EAA0C8I,MAA1C;;AAEA,SAAS7K,SAAT,GAAqB;AACpB;AACA;AACAhE,SAAQ,IAAIgP,KAAJ,EAAR;AACAhP,OAAM8F,UAAN,CAAiBmJ,KAAjB,CAAuBjW,QAAvB,GAAkC,UAAlC;AACA;AACAgH,OAAM8F,UAAN,CAAiBmJ,KAAjB,CAAuBC,IAAvB,GAA8B,KAA9B;AACAlP,OAAM8F,UAAN,CAAiBmJ,KAAjB,CAAuBrC,GAAvB,GAA6B,KAA7B;AACA5M,OAAM8F,UAAN,CAAiBmJ,KAAjB,CAAuBE,MAAvB,GAAgC,GAAhC;AACArR,WAAU+H,WAAV,CAAsB7F,MAAM8F,UAA5B;AACA,QAAO9F,KAAP;AACA;;AAGD,SAASoP,yBAAT,CAAmC1T,KAAnC,EAA0C;AACzC,KAAI2T,UAAUhH,KAAKC,EAAL,GAAU,GAAxB;AACAzL,QAAOuL,QAAP,CAAgBtO,GAAhB,CACO,CAAC4B,MAAM4T,IAAP,GAAcD,OADrB,EAEO,CAAC3T,MAAM6T,KAAP,GAAe,CAAf,GAAmB7T,MAAM6T,KAAN,GAAcF,OAFxC,EAGO,CAAC3T,MAAM8T,KAAP,GAAe,CAAf,GAAmB9T,MAAM8T,KAAN,GAAcH,OAHxC;;AAMA9T,SAAQC,GAAR,CAAYE,MAAM4T,IAAN,GAAaD,OAAzB;AACA9T,SAAQC,GAAR,CAAYE,MAAM6T,KAAN,GAAcF,OAA1B;AACA9T,SAAQC,GAAR,CAAYE,MAAM8T,KAAN,GAAcH,OAA1B;;AAEO;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACN;AACM;AACA;AACA;AACA;AACN;AACM;AACA;AACA;AACA;AACP;;AAED;AACA,SAASI,4BAAT,CAAuCtR,QAAvC,EAAkD;;AAEjD,KAAIuR,eAAepS,SAASqS,aAAT,CAAwB,iBAAxB,CAAnB;AACA,KAAIC,wBAAwBF,aAAaG,WAAzC;AACA,KAAIC,uBAAuBxS,SAASqS,aAAT,CAAwB,iBAAxB,CAA3B;AACA,KAAII,4BAA4BzS,SAASqS,aAAT,CAAwB,0BAAxB,CAAhC;;AAEA;AACAxR,UAAS4H,gBAAT,CAA2B,sBAA3B,EAAmD,YAAY;AAC9DtG,WAASqG,UAAT,CAAoBmJ,KAApB,CAA0Be,MAA1B,GAAmC,MAAnC;AACAF,uBAAqBb,KAArB,CAA2BzU,OAA3B,GAAqC,MAArC;AACA,EAHD;;AAKA2D,UAAS4H,gBAAT,CAA2B,oBAA3B,EAAiD,YAAY;AAC5DtG,WAASqG,UAAT,CAAoBmJ,KAApB,CAA0Be,MAA1B,GAAmC,SAAnC;AACAF,uBAAqBb,KAArB,CAA2BzU,OAA3B,GAAqC,cAArC;AACA,EAHD;;AAKA;AACA2D,UAAS4H,gBAAT,CAA2B,aAA3B,EAA0C,YAAY;AACrD2J,eAAaO,SAAb,GAAyB,eAAzB;AACA,EAFD;;AAIA9R,UAAS4H,gBAAT,CAA2B,WAA3B,EAAwC,YAAY;AACnD2J,eAAaO,SAAb,GAAyBL,qBAAzB;AACA,EAFD;;AAIA;AACAzR,UAAS4H,gBAAT,CAA2B,WAA3B,EAAwC,YAAY;AACnD2J,eAAaO,SAAb,GAAyB,aAAzB;AACA,EAFD;;AAIA9R,UAAS4H,gBAAT,CAA2B,SAA3B,EAAsC,YAAY;AACjD2J,eAAaO,SAAb,GAAyBL,qBAAzB;AACA,EAFD;;AAIA;AACAE,sBAAqB/J,gBAArB,CAAuC,OAAvC,EAAgD,UAAWrK,KAAX,EAAmB;AAClEA,QAAMgQ,cAAN;;AAEA,MAAKvN,SAAS+R,cAAT,KAA4B,IAAjC,EAAwC;AACvCJ,wBAAqBD,WAArB,GAAmC,iBAAnC;AACA1R,YAAS+R,cAAT,GAA0B,KAA1B;AACA,GAHD,MAGO;AACNJ,wBAAqBD,WAArB,GAAmC,aAAnC;AACA1R,YAAS+R,cAAT,GAA0B,IAA1B;AACA;AACD,EAVD,EAUG,KAVH;AAWA","file":"app.js","sourcesContent":["\nlet position = {\n\tlon: 30\n}\nlet curPosX = 30;\nlet fovMin = 75;\nlet fovMax = 50;\nlet onPointerDownPointerX;\nlet onPointerDownLon;\nlet blocked = false;\n\n\n//************************************************************************//\n//                             Init Loader                                //\n//************************************************************************//\n\nlet showLoader = false;\n\nif(showLoader) {\n\tvar bar = new ProgressBar.Path('.st0', {\n\t\teasing: 'easeInOut',\n\t\tduration: 800\n\t});\n\tbar.set(0)\n\n\tlet percent = 0.1\n\tlet int = setInterval(function() {\n\t\tpercent += 0.1;\n\t\tif(percent >= 1.0) {\n\t\t\tclearInterval(int);\n\t\t} else {\n\t\t\tbar.animate(percent, () => {\n\t\t\t\tTweenMax.to($('#loader') , 0.3, {autoAlpha: 0, display: 'none'});\n\t\t\t});\n\t\t\tlet fixed = (percent*100).toFixed(0);\n\t\t\t$('text').html(`${fixed}%`)\n\t\t}\n\t}, 500)\n\n\t// THREE.DefaultLoadingManager.onProgress = function ( item, loaded, total ) {\n\t// \tlet percent = loaded/total\n\t// \tbar.animate(percent, function() {\n\t// \t\tTweenMax.to($('#loader') , 0.3, {autoAlpha: 0, display: 'none'});\n\t// \t});\n\t// \tlet fixed = (percent*100).toFixed(0);\n\t// \t$('text').html(`${fixed}%`);\n\t// };\n} else {\n\t$('#loader').hide();\n}\n\nfunction setupButtons() {\n\t$('.button-outer .logo').each(function() {\n\t\tvar $el = $(this);\n\t\tvar clone = $el.find('.clone').clone().attr('class', 'fill blur');\n\t\t$el.append(clone);\n\t});\n\t$('.inner-path').each(function() {\n\t\tvar $el = $(this);\n\t\tvar clone = $el.clone().attr('class', 'blur');\n\t\t$el.after(clone);\n\t});\n\t$('.button-outer').on('mouseenter', function() {\n\t\tvar key = $(this).attr('key');\n\t\tconsole.log('moustenter', key);\n\t\tbuttons[key].animate(1);\n\t});\n\t$('.button-outer').on('mouseleave', (event) => {\n\t\tvar key = $(event.currentTarget).attr('key');\n\t\tbuttons[key].set(0);\n\t});\n}\n\nvar buttons = {};\n\n\n//************************************************************************//\n//                             Init Audio                                 //\n//************************************************************************//\n\n// let audio = document.createElement('audio');\n// let source = document.createElement('source');\n// source.src = 'audio/AC-Trailer.mp3';\n// audio.appendChild(source);\n// audio.play();\n\nfunction Modal(hotspot) {\n\tthis.modal = $('.modal');\n\tthis.item = this.modal.find('.item');\n\tthis.content = this.modal.find('.content');\n}\n\nModal.prototype = {\n\tprev() {\n\t\tconsole.log('prev!');\n\t\tlet content = this.content;\n\t\tlet duration = this.duration;\n\t\tTweenMax.to(content, duration, {autoAlpha: 0, onComplete: () => {\n\t\t\tthis.offset = this.offset === 0 ? this.hotspot.slides.length-1 : this.offset-1;\n\t\t\tthis.item.attr('src', this.hotspot.slides[this.offset].image);\n\t\t\tTweenMax.to(content, duration, {autoAlpha: 1});\n\t\t}});\n\t},\n\tnext() {\n\t\tconsole.log('next!');\n\t\tlet content = this.content;\n\t\tlet duration = this.duration;\n\t\tTweenMax.to(content, duration, {autoAlpha: 0, onComplete: () => {\n\t\t\tthis.offset = this.offset+1 === this.hotspot.slides.length ? 0 : this.offset+1;\n\t\t\tthis.item.attr('src', this.hotspot.slides[this.offset].image);\n\t\t\tTweenMax.to(content, duration, {autoAlpha: 1});\n\t\t}})\n\t},\n\tduration: 0.35,\n\toffset: 0,\n\tshowSliderControls() {\n\t\t$('.modal .controls').fadeIn();\n\t},\n\thide() {\n\t\tfor(var i in buttons) {\n\t\t\tbuttons[i].set(0);\n\t\t}\n\t\tlet duration = 550/1000\n\t\tshowingModal = false;\n\t\t// pointerLock();\n\t\tTweenMax.to($('.modal-container') , 0.3, {autoAlpha: 0})\n\t\tTweenMax.to(camera, duration, {fov: fovMin, onComplete: function() {\n\t\t\tblocked = false;\n\t\t}});\n\t},\n\tshow(hotspot, subid) {\n\t\tthis.hotspot = hotspot;\n\t\tthis.subid = subid;\n\t\tthis.offset = 0;\n\t\t// let urlParams = makeUrlParams(hotspot.id);\n\t\t// history.replaceState(null, null, urlParams);\n\t\tlet duration = 550/1000;\n\t\tshowingModal = true;\n\t\tif(hotspot.slides && hotspot.slides.length > 0) {\n\t\t\tthis.showSliderControls();\n\t\t\tlet firstSlide = hotspot.slides[this.offset];\n\t\t\t$('.modal .item').attr('src', firstSlide.image);\n\t\t}\n\t\tTweenMax.to($('.modal-container') , 0.3, {autoAlpha: 1})\n\t\tTweenMax.to(camera, duration, {fov: fovMax, onComplete: spawnModal(hotspot)})\n\t}\n}\nlet modal = new Modal();\n\nlet audio = new Audio('audio/AC-Trailer.mp3');\n// audio.play();\n\nlet playAudio = true;\n\n// herp derp\n\n$(document).ready(function() {\n\n\t$('.button-outer').each((index, el) => {\n\t\tvar $el = $(el);\n\t\tvar key = $el.attr('key');\n\t\tbuttons[key] = new ProgressBar.Path($el.find('.outer-path').get(0), {\n\t\t\teasing: 'easeInOut',\n\t\t\tduration: 500\n\t\t});\n\t\tbuttons[key].set(0);\n\t});\n\n\t$('.button-outer').on('mouseenter', function() {\n\t\tvar key = $(this).attr('key');\n\t\tconsole.log('moustenter', key);\n\t\tbuttons[key].animate(1);\n\t\t// $(this).find('.outer-path').data('progress')\n\t});\n\n\t$('.button-outer').on('mouseleave', (event) => {\n\t\tvar key = $(event.currentTarget).attr('key');\n\t\tbuttons[key].set(0);\n\t\t// $(event.currentTarget).find('.outer-path').data('progress').set(0);\n\t});\n\n\t$('.controls.next').on('click', (event) => {\n\t\tmodal.next();\n\t\tevent.stopPropagation();\n\t});\n\n\t$('.controls.prev').on('click', (event) => {\n\t\tmodal.prev();\n\t\tevent.stopPropagation();\n\t});\n\n\t$('.button-outer').on('click', (event) => {\n\t\tvar key = $(event.currentTarget).attr('key');\n\t\thandleButtonClick(key);\n\t});\n\n\tlet offLine = $('.sound line');\n\tlet container = offLine.parents('svg');\n\t$('.sound').on('click', () => {\n\t\tif(playAudio) {\n\t\t\taudio.pause();\n\t\t\toffLine.show();\n\t\t\tcontainer.attr('class', 'off');\n\t\t} else {\n\t\t\taudio.play();\n\t\t\toffLine.hide();\n\t\t\tcontainer.attr('class', '');\n\t\t}\n\t\tplayAudio = !playAudio;\n\t});\n\n\tsetupButtons();\n});\n\n//************************************************************************//\n//                              Variables                           \t  //\n//************************************************************************//\n\nlet camera, container, color, controls, clock, delta, deviceControls, h, hotspot, info, logoGeo, logoMaterial, logoMesh, logoTexture, marker, mesh, materials = [], mouse, mousePos, objects = [], parameters, particles, particleMaterial, rainDensity = 20000, rainGeometry, raycaster, renderer, scene, size, smokeParticles = [], spotLight, spotLightHelper, sprite, stats; \nlet layer = false;\nlet hsParticles = [];\nlet rotateSpeed = 0.03\nlet hotspots = [];\nlet hotspotObjects = [\n\t{\n\t\tid: 0,\n\t\tslides: [\n\t\t\t{\n\t\t\t\timage: 'textures/cowl.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/glaive.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/halberd.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/vambrace.png'\n\t\t\t}\n\t\t],\n\t\tlon: 19,\n\t\tposition: [450, 0, 150],\n\t},\n\t{\n\t\tid: 1,\n\t\tlon: 39,\n\t\tslides: [\n\t\t\t{\n\t\t\t\timage: 'textures/cowl.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/glaive.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/halberd.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/vambrace.png'\n\t\t\t}\n\t\t],\n\t\tposition: [370, 0, 280],\n\t},\n\t{\n\t\tid: 2,\n\t\tlon: 87.5,\n\t\tslides: [\n\t\t\t{\n\t\t\t\timage: 'textures/cowl.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/glaive.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/halberd.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/vambrace.png'\n\t\t\t}\n\t\t],\n\t\tposition: [25, 0, 400],\n\t},\n\t{\n\t\tid: 3,\n\t\tlon: 106,\n\t\tslides: [\n\t\t\t{\n\t\t\t\timage: 'textures/cowl.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/glaive.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/halberd.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/vambrace.png'\n\t\t\t}\n\t\t],\n\t\tposition: [-115, 0, 400],\n\t},\n\t{\n\t\tid: 4,\n\t\tlon: 153,\n\t\tslides: [\n\t\t\t{\n\t\t\t\timage: 'textures/cowl.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/glaive.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/halberd.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/vambrace.png'\n\t\t\t}\n\t\t],\n\t\tposition: [-400, 0, 205],\n\t},\n\t{\n\t\tid: 5,\n\t\tlon: 175,\n\t\tslides: [\n\t\t\t{\n\t\t\t\timage: 'textures/cowl.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/glaive.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/halberd.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/vambrace.png'\n\t\t\t}\n\t\t],\n\t\tposition: [-445, 0, 30],\n\t},\n\t{\n\t\tid: 6,\n\t\tlon: 236,\n\t\tslides: [\n\t\t\t{\n\t\t\t\timage: 'textures/cowl.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/glaive.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/halberd.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/vambrace.png'\n\t\t\t}\n\t\t],\n\t\tposition: [-265, 0, -380],\n\t},\n\t{\n\t\tid: 7,\n\t\tlon: 262.5,\n\t\tslides: [\n\t\t\t{\n\t\t\t\timage: 'textures/cowl.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/glaive.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/halberd.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/vambrace.png'\n\t\t\t}\n\t\t],\n\t\tposition: [-60, 0, -455],\n\t},\n\t{\n\t\tid: 8,\n\t\tlon: 286.5,\n\t\tslides: [\n\t\t\t{\n\t\t\t\timage: 'textures/cowl.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/glaive.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/halberd.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/vambrace.png'\n\t\t\t}\n\t\t],\n\t\tposition: [125, 0, -455],\n\t},\n\t{\n\t\tid: 9,\n\t\tlon: 332,\n\t\tslides: [\n\t\t\t{\n\t\t\t\timage: 'textures/cowl.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/glaive.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/halberd.png'\n\t\t\t},\n\t\t\t{\n\t\t\t\timage: 'textures/vambrace.png'\n\t\t\t}\n\t\t],\n\t\tposition: [400, 0, -205]\n\t},\n];\nlet onMouseDownMouseX = 0, onMouseDownMouseY = 0,\nonMouseDownLon = 0,\nlat = 0, onMouseDownLat = 0,\nphi = 0, theta = 0;\n\ncontainer = document.getElementById( 'container' );\n\nlet containerWidth = container.clientWidth;\nlet containerHeight = container.clientHeight;\n\nlet selectedObjects = [];\nlet loader;\nlet renderPass;\nlet outlinePass;\nlet composer;\nlet effectFXAA;\n// let controlsEnabled = true;\nlet showingModal = false;\nlet initialOrientation;\nlet isUserInteracting = false;\n\nlet projector = new THREE.Projector();\nlet mouseVector = new THREE.Vector3();\n\nlet currentHotspot;\n\nlet touchDevice\nif (('ontouchstart' in window) || window.DocumentTouch && document instanceof DocumentTouch) { \n\ttouchDevice = true;\n}\n\ninit();\nanimate();\n\n//************************************************************************//\n//                             Init Scene                                 //\n//************************************************************************//\n\nfunction init() {\n\n\tvar width = window.innerWidth || 1;\n\tvar height = window.innerHeight || 1;\n\tvar devicePixelRatio = window.devicePixelRatio || 1;\n\trenderer = new THREE.WebGLRenderer( { antialias: false } );\n\trenderer.shadowMap.enabled = true;\n\trenderer.setClearColor( 0xa0a0a0 );\n\trenderer.setPixelRatio( 1 );\n\trenderer.setSize( width, height );\n\n\tcamera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 2000 );\n\tcamera.target = new THREE.Vector3( 0, 0, 0 );\n\tscene = new THREE.Scene();\n\n\tlet geometry = new THREE.SphereGeometry( 500, 60, 400 );\n\tgeometry.scale( - 1, 1, 1 );\n\n\tlet material = new THREE.MeshBasicMaterial( {\n\t\tmap: new THREE.TextureLoader().load( 'textures/AnimusPanoramaTreated.jpg' ),\n\t\tfog: true,\n\t});\n\t\n\tmesh = new THREE.Mesh( geometry, material );\n\tmesh.name = 'scene';\n\tscene.add( mesh );\n\t\n\tstats = initStats()\n\t\n\traycaster = new THREE.Raycaster();\n\tmouse = new THREE.Vector2();\n\t\n\t// Build items for raycaster clicks\n\tbuildHotspots();\n\t\n\t// Device Orientation Stuff\t\n\t// deviceControls = new DeviceOrientationController( camera, renderer.domElement );\n\t// deviceControls.connect()\n\t// setupControllerEventHandlers( deviceControls )\n\n\t// if (window.DeviceOrientationEvent) {\n\t// \tconsole.log(\"Wonderful, Our browser supports DeviceOrientation\");\n\t// \twindow.addEventListener(\"deviceorientation\", deviceOrientationListener, false);\n\t// \tdeviceControls = new THREE.DeviceOrientationControls( camera, renderer.domElement );\n\t// } else {\n\t// \tconsole.log(\"Sorry, your browser doesn't support Device Orientation\");\n\t// }\n\n\t\n\tclock = new THREE.Clock();\n\n\t// postprocessing\n\tcomposer = new THREE.EffectComposer( renderer );\n\trenderPass = new THREE.RenderPass( scene, camera );\n\tcomposer.addPass( renderPass );\n\toutlinePass = new THREE.OutlinePass( new THREE.Vector2(window.innerWidth, window.innerHeight), scene, camera);\n\n\toutlinePass.edgeStrength = 0.5;\n\toutlinePass.edgeGlow = 5.0;\n\toutlinePass.edgeThickness = 1.0;\n\toutlinePass.pulsePeriod = 0.5;\n\toutlinePass.visibleEdgeColor = {r: 255, g: 255, b: 255};\n\n\tcomposer.addPass( outlinePass );\n\t// @todo: prob dont need this texture but SHRUG\n\tvar onLoad = function(texture) {\n\t\toutlinePass.patternTexture = texture;\n\t\ttexture.wrapS = THREE.RepeatWrapping;\n\t\ttexture.wrapT = THREE.RepeatWrapping;\n\t};\n\tvar lod = new THREE.TextureLoader();\n\tlod.load(\n\t\t// resource URL\n\t\t'textures/tri_pattern.jpg',\n\t\t// Function when resource is loaded\n\t\tonLoad\n\t);\n\n\teffectFXAA = new THREE.ShaderPass(THREE.FXAAShader);\n\teffectFXAA.uniforms['resolution'].value.set(1 / window.innerWidth, 1 / window.innerHeight );\n\teffectFXAA.renderToScreen = true;\n\tcomposer.addPass( effectFXAA );\n\n\tcontainer.appendChild( renderer.domElement );\n\t// container.addEventListener(\"mousemove\", getPosition, false);\n\n\n\t// @todo: event aliasing\n\t// document.addEventListener(touchDevice ? 'touchstart' : 'mousedown', onDocumentMouseDown, false );\n\t// document.addEventListener(touchDevice ? 'touchmove' : 'mousemove', onDocumentMouseMove, false );\n\t// document.addEventListener(touchDevice ? 'touchend' : 'mouseup', onDocumentMouseUp, false );\n\n\tdocument.addEventListener('mousedown', onDocumentMouseDown, false );\n\tdocument.addEventListener('mousemove', onDocumentMouseMove, false );\n\tdocument.addEventListener('mouseup', onDocumentMouseUp, false );\n\n\tdocument.addEventListener( 'touchstart', onDocumentTouchStart, false );\n\t// document.addEventListener( 'wheel', onDocumentMouseWheel, false );\n\twindow.addEventListener( 'resize', onWindowResize, false );\n\t\n\tinitRain();\n\t// buildSmoke();\n\torientCamera();\n\t\n\tdocument.body.appendChild( renderer.domElement );\n\n}\n\nfunction getUrlParams() {\n\tvar urlParams,\n\t\tmatch,\n\t    pl     = /\\+/g,  // Regex for replacing addition symbol with a space\n\t    search = /([^&=]+)=?([^&]*)/g,\n\t    decode = function (s) { return decodeURIComponent(s.replace(pl, \" \")); },\n\t    query  = window.location.search.substring(1);\n\n\turlParams = {};\n\twhile (match = search.exec(query))\n\t   urlParams[decode(match[1])] = decode(match[2]);\n\treturn urlParams;\n}\n\nfunction orientCamera() {\n\tvar urlParams = getUrlParams();\n\tif(urlParams.id) {\n\t\tlet id = parseInt(urlParams.id)\n\t\tlet hotspot = hotspotObjects.filter( hotspot => id === hotspot.id );\n\t\tif(hotspot) {\n\t\t\thotspot = hotspot[0]\n\t\t\tinitialOrientation = hotspot.lon;\n\t\t\tcurrentHotspot = hotspot\n\t\t\tmodal.show(hotspot);\n\t\t}\n\t}\n}\n\nlet buttonClicks = {\n\t'ig-header'() {\n\t\tconsole.log('igHeader');\n\t},\n\tfb() {\n\t\tconsole.log('fbshare');\n\t}\n}\nfunction handleButtonClick(key) {\n\tif(key in buttonClicks) buttonClicks[key]();\n}\n\nfunction buildHotspots() {\n\tloader = new THREE.JSONLoader();\n\tloader.load('js/ac-badge-big.js', function(geometry) {\n\t// loader.load('js/ac-badge.js', function(geometry) {\n\t// loader.load('js/ac-logo.js', function(geometry) {\n\t\thotspots = hotspotObjects.map( (hotspotObject, index) => {\n\t\t\tgeometry.center();\n\n\t\t\t// previous ac-logo.js scale\n\t\t\t// let scale = 10;\n\n\t\t\tlet scale = 45;\n\n\t\t\t// let newMat = new THREE.MeshPhongMaterial( { \n\t\t\t// \tcolor: 0x996633, \n\t\t\t// \tspecular: 0x050505,\n\t\t\t// \tshininess: 100\n\t\t\t// } ) \n\n\t\t\tlet oldMat = new THREE.MeshBasicMaterial( { color: '#cccccc', opacity: 1 } )\n\n\t\t\tlet hotspot = new THREE.Mesh(geometry, oldMat);\n\t\t\thotspot.name = `hotspot-${index}`;\n\t\t\tvar box = new THREE.Box3().setFromObject(hotspot);\n\t\t\thotspot.scale.x = hotspot.scale.y = hotspot.scale.z = scale\n\t\t\thotspot.rotation.x = .5*Math.PI\n\t\t\thotspot.hotspot = hotspotObject;\n\n\t\t\tlet hitboxGeo = new THREE.BoxBufferGeometry( box.getSize().x * scale * 1.2, box.getSize().x * scale * 1.2 , box.getSize().x * scale * 1.2 );\n\t\t\tlet hitboxMat = new THREE.MeshBasicMaterial({ visible: false });\n\t\t\t// {wireframe: true}\n\t\t\t// // hitboxMat.visible = false\n\t\t\tlet hitboxMesh = new THREE.Mesh( hitboxGeo, hitboxMat );\n\t\t\thitboxMesh.name = `hitbox-${index}`;\n\n\t\t\tlet hotspotLocation = hotspotObject.position;\n\n\t\t\tvar group = new THREE.Group();\n\t\t\tgroup.name = `group-${index}`\n\t\t\tgroup.position.set(hotspotLocation[0], hotspotLocation[1], hotspotLocation[2]);\n\t\t\tscene.add(group);\n\t\t\tgroup.add(hotspot);\n\t\t\tgroup.add(hitboxMesh);\n\n\t\t\treturn group;\n\n\t\t});\n\t});\n}\n\nfunction buildSmoke() {\n\t// Smoke Light\n\tlet light = new THREE.DirectionalLight(0xffffff, 1.5);\n\tlight.position.set(-1, 0, 1);\n\tscene.add(light);\n\t\n\tlet directionalLight = new THREE.DirectionalLight(0xffffff);\n\tdirectionalLight.position.set(1, 1, 1).normalize();\n\tscene.add(directionalLight);\n  \n\tlet smokeTexture = THREE.ImageUtils.loadTexture('https://s3-us-west-2.amazonaws.com/s.cdpn.io/95637/Smoke-Element.png');\n\tlet smokeMaterial = new THREE.MeshLambertMaterial({\n\t\tcolor: 0xffffff, \n\t\tmap: smokeTexture, \n\t\ttransparent: true\n\t});\n\tlet smokeGeo = new THREE.PlaneGeometry(500, 500);\n\t \n\tfor (let p = 0; p < 150; p++) {\n\t\tlet particle = new THREE.Mesh(smokeGeo,smokeMaterial);\n\t\tparticle.position.set(Math.random()*500-250,Math.random()*500-250,Math.random()*1000-100);\n\t\tparticle.rotation.z = Math.random() * 360;\n\t\tscene.add(particle);\n\t\tsmokeParticles.push(particle);\n\t}\n}\n\n\nfunction evolveSmoke() {\n\tlet sp = smokeParticles.length;\n\twhile(sp--) {\n\t\tsmokeParticles[sp].rotation.z += (delta * 0.2);\n\t}\n}\n\nfunction initRain() {\n\trainGeometry = new THREE.Geometry();\n\n\tlet sprite1 = THREE.ImageUtils.loadTexture( \"textures/rain1.png\" ),\n\tsprite2 = THREE.ImageUtils.loadTexture( \"textures/rain2.png\" ),\n\tsprite3 = THREE.ImageUtils.loadTexture( \"textures/rain3.png\" ),\n\tsprite4 = THREE.ImageUtils.loadTexture( \"textures/rain4.png\" ),\n\tsprite5 = THREE.ImageUtils.loadTexture( \"textures/rain5.png\" );\n\n\tfor (let i = 0; i < rainDensity; i++ ) {\n\t\tlet vertex = new THREE.Vector3();\n\t\tvertex.x = Math.random() * 2000 - 1000;\n\t\tvertex.y = Math.random() * 4000 + 500;\n\t\tvertex.z = Math.random() * 2000 - 1000;\n\n\t\trainGeometry.vertices.push( vertex );\n\t}\n\n\tparameters = [ [ [1.0, 0.2, 0.5], \tsprite2, 20 ],\n\t\t\t\t   [ [0.95, 0.1, 0.5], \tsprite3, 15 ],\n\t\t\t\t   [ [0.90, 0.05, 0.5], sprite1, 10 ],\n\t\t\t\t   [ [0.85, 0, 0.5], \tsprite5, 8 ],\n\t\t\t\t   [ [0.80, 0, 0.5], \tsprite4, 5 ],\n\t\t\t\t   ];\n\n\tfor (let i = 0; i < parameters.length; i++ ) {\n\n\t\tcolor  = parameters[i][0];\n\t\tsprite = parameters[i][1];\n\t\tsize   = parameters[i][2];\n\n\t\tmaterials[i] = new THREE.PointCloudMaterial({ \n\t\t\tsize: size, \n\t\t\tmap: sprite, \n\t\t\tblending: THREE.AdditiveBlending, \n\t\t\tdepthTest: false, \n\t\t\ttransparent : true \n\t\t});\n\t\tmaterials[i].color.setHSL( color[0], color[1], color[2] );\n\n\t\tparticles = new THREE.PointCloud( rainGeometry, materials[i] );\n\n\t\tparticles.rotation.z = Math.random() * 0.20 + 0.10;\n\n\t\tscene.add( particles );\n\t}\n}\n\nfunction animateRain() {\n\t// console.log(\"I'M ANIMATING THINGS\");\n\tlet time = Date.now() * 0.00005;\n\n\tfor (let i = 0; i < scene.children.length; i++ ) {\n\n\t\tlet object = scene.children[i];\n\t\t\n\t\tif ( object instanceof THREE.PointCloud ) {\n\t\t\t// Not getting into the log here\n\t\t\tconsole.log(\"I'M ANIMATING THINGS\");\n\t\t\tif (i == 0) {\n\t\t\t\tobject.translateY(-10);\n\t\t\t}\n\n\t\t\tif (i > 0) {\n\t\t\t\tif (layer)\n\t\t\t\t\tobject.translateY(-10);\n\t\t\t\telse\n\t\t\t\t\tif(scene.children[i-1].position.y < ((window.innerHeight * -1) / 2 - 1000))\n\t\t\t\t\t\tobject.translateY(-10);\n\t\t\t}\n\n\t\t\tif ((object.position.y < window.innerHeight * -1 * 5)) {\n\t\t\t\t\tobject.position.y = 500;\n\t\t\t\t\tobject.position.x = 0;\n\t\t\t\t\tif (i == 0) layer = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tfor (let i = 0; i < materials.length; i++ ) {\n\n\t\tcolor = parameters[i][0];\n\n\t\th = ( 360 * ( color[0] + time ) % 360 ) / 360;\n\t\tmaterials[i].color.setHSL( h, color[1], color[2] );\n\n\t}\n}\n\nfunction onWindowResize() {\n\tvar width = window.innerWidth || 1;\n\tvar height = window.innerHeight || 1;\n\tvar devicePixelRatio = window.devicePixelRatio || 1;\n\tcamera.aspect = width / height;\n\tcamera.updateProjectionMatrix();\n\trenderer.setSize( width, height );\n\tcomposer.setSize( width, height );\n\teffectFXAA.uniforms['resolution'].value.set(1 / window.innerWidth, 1 / window.innerHeight );\n}\n\nfunction onDocumentTouchStart( event ) {\n\tevent.preventDefault();\n\tevent.clientX = event.touches[0].clientX;\n\tevent.clientY = event.touches[0].clientY;\n\tonDocumentMouseDown( event );\n}\n\nfunction addSelectedObject(object) {\n\tselectedObjects = [];\n\tselectedObjects.push(object);\n}\n\nfunction checkRaycasterCollisions(event) {\n\n\tvar mouse3D = new THREE.Vector3( ( event.clientX / window.innerWidth ) * 2 - 1,\n\t\t\t\t\t\t\t\t\t-( event.clientY / window.innerHeight ) * 2 + 1,\n\t\t\t\t\t\t\t\t\t0.5 );\n\traycaster.setFromCamera( mouse3D, camera );\n\tlet intersects = raycaster.intersectObjects(scene.children, true);\n\tlet items = intersects.filter( intersect => intersect.object.name.match(/hitbox/) );\n\tif(items.length) {\n\t\titems.forEach((item) => {\n\t\t\tlet target = item.object.parent.children[0]\n\t\t\tif(selectedObjects.indexOf(target) === -1) {\n\t\t\t\t$('body').addClass('hot');\n\t\t\t\taddSelectedObject(target);\n\t\t\t}\n\t\t});\n\t} else {\n\t\t$('body').removeClass('hot');\n\t\tselectedObjects = [];\n\t}\n\toutlinePass.selectedObjects = selectedObjects;\n}\n\n// function renderFeatureMesh() {\n// \tvar feature = $('.feature');\n\n// \tif(feature.find('canvas').length) return;\n// \tvar scene = new THREE.Scene();\n// \tvar camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);\n\n// \tvar renderer = new THREE.WebGLRenderer();\n// \trenderer.setSize(feature.width(), feature.height());\n// \tfeature.append(renderer.domElement);\n\n// \tvar geometry = new THREE.CubeGeometry(5, 5, 5);\n// \tvar material = new THREE.MeshLambertMaterial({\n// \t\tcolor: 0x00fff0\n// \t});\n// \tvar cube = new THREE.Mesh(geometry, material);\n// \tscene.add(cube);\n\n// \tcamera.position.z = 12;\n\n// \tvar pointLight = new THREE.PointLight(0xFFFFFF);\n\n// \tpointLight.position.x = 10;\n// \tpointLight.position.y = 50;\n// \tpointLight.position.z = 130;\n\n// \tscene.add(pointLight);\n\n// \tvar reqAnimFrame = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.msRequestAnimationFrame;\n\n// \tvar render = function() {\n// \t\treqAnimFrame(render);\n\n// \t\tvar delta = Math.random() * (0.06 - 0.02) + 0.02;\n\n// \t\tcube.rotation.x += delta;\n// \t\tcube.rotation.y += delta;\n// \t\tcube.rotation.z -= delta;\n\n// \t\trenderer.render(scene, camera);\n// \t};\n\n// \trender();\n// }\n\nfunction spawnModal(hotspot) {\n\n\t$('.modal-container').css({top: 0})\n\t$('.modal-container .close').on('click', modal.hide);\n\n\t$('.overlay').on('click', modal.hide);\n\t$(document).on('keydown', (event) => {\n\t\tif(event.keyCode === 27) {\n\t\t\tmodal.hide();\n\t\t} \n\t});\n\n\t// if(hotspot.content) {\n\t// \tif(hotspot.content.header) $('.modal .content h1').text(hotspot.content.header);\n\t// \tif(hotspot.content.body) $('.modal .content p').text(hotspot.content.body);\n\t// }\n\t// renderFeatureMesh();\n}\n\nfunction makeUrlParams(id, subid) {\n\tlet str = '';\n\tif(id !== undefined || id !== null) {\n\t\tstr += `?id=${id}`;\n\t}\n\tif(!subid) subid = 0;\n\tstr += `&subid=${subid}`;\n\tconsole.log('makeUrlParams', id, subid, str);\n\treturn str;\n}\n\nfunction tweenArc(start, end) {\n\tlet relativity;\n\tlet delta = start-end;\n\tlet absDelta = Math.abs(delta);\n\tif(start < end) {\n\t\trelativity = absDelta < 180 ? '+=' : '-=';\n\t} else {\n\t\trelativity = absDelta < 180 ? '-=' : '+=';\n\t}\n\treturn {value: 360-absDelta < absDelta ? 360-absDelta : absDelta, relativity: relativity};\n}\n\nfunction onDocumentMouseDown( event ) {\n\tisUserInteracting = true;\n\tif(selectedObjects.length && !showingModal) {\n\t\tlet so = selectedObjects[0].hotspot;\n\t\tlet currentLon = position.lon\n\t\tlet hotspotLon = selectedObjects[0].hotspot.lon\n\t\tlet data = tweenArc(currentLon, hotspotLon);\n\t\tTweenMax.to(position, 550/1000, {lon: `${data.relativity}${data.value}`, onComplete: function() {\n\t\t\tposition.lon = position.lon%360;\n\t\t\tcurPosX = position.lon;\n\t\t\tcurrentHotspot = so\n\t\t\tmodal.show(so, 0);\n\t\t}});\n\t}\n}\n\nfunction rotateHotspots() {\n\thotspots.forEach( hotspot => hotspot.children[0].rotation.z += rotateSpeed * 0.5 );\n}\n\nfunction onDocumentMouseMove( event ) {\n\tcheckRaycasterCollisions(event);\n\tif(isUserInteracting && !showingModal) {\n\t\tlet movementX = event.movementX || event.mozMovementX || event.webkitMovementX || 0;\n\t\tlet movementY = event.movementY || event.mozMovementY || event.webkitMovementY || 0;\n\t\tcurPosX += movementX;\n\t\tif(curPosX < 0) {\n\t\t\tcurPosX = 360 + curPosX;\n\t\t}\n\t\tif(curPosX > 360) {\n\t\t\tcurPosX = 0;\n\t\t}\n\t\tposition.lon = curPosX;\n\t}\n}\n\nfunction onDocumentMouseUp( event ) {\n\tisUserInteracting = false;\n}\n\n// Zoom in & out | Need to limit this to the starting point and a endind point\nfunction onDocumentMouseWheel( event ) {\n\tif (camera.fov > 75) {\n\t\tcamera.fov = 75\n\t} else {\n\t\tcamera.fov += event.deltaY * 0.02;\n\t\tcamera.updateProjectionMatrix();\n\t}\n\t// camera.fov += event.deltaY * 0.02;\n\t// camera.updateProjectionMatrix();\n}\n\nfunction animate() {\n\trequestAnimationFrame( animate );\n\tupdate();\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n}\n\nfunction update() {\n\t// if ( isUserInteracting === false ) {\n\t// \t// lon += 0.1;\n\t// }\n\t// console.log('initialOrientation', lon, initialOrientation)\n\t// console.log('update', lon)\n\tif(initialOrientation) {\n\t\tposition.lon = initialOrientation;\n\t\tinitialOrientation = null;\n\t}\n\n\tlat = Math.max( - 85, Math.min( 85, lat ) );\n\tphi = THREE.Math.degToRad( 90 - lat );\n\ttheta = THREE.Math.degToRad( position.lon );\n\n\tcamera.target.x = 1 * Math.sin( phi ) * Math.cos( theta );\n\t// camera.target.y = 1 * Math.cos( phi );\n\tcamera.target.z = 1 * Math.sin( phi ) * Math.sin( theta );\n\tcamera.lookAt( camera.target );\n\n\t/*\n\t// distortion\n\tcamera.position.copy( camera.target ).negate();\n\t*/\n\t// let delta = clock.getDelta(), speed = delta * CAMERAMOVESPEED;\n\t// controls.update(delta);\n\t// spotLight.target = marker;\n\t// controls.update()\n\t\n\t// spotLightHelper.update()\n\tstats.update()\n\tdelta = clock.getDelta();\n\n\tevolveSmoke();\n\t// animateRain();\n\t// rotateHotspot();\n\trotateHotspots();\n\n\t// checkRaycasterCollisions();\n\n\t// rainEngine.update(0.01 * 0.5)\n\ttheta += 0.1;\n\t// let radius = 600;\n\t// camera.position.x = radius * Math.sin( THREE.Math.degToRad( theta ) );\n\t// camera.position.y = radius * Math.sin( THREE.Math.degToRad( theta ) );\n\t// camera.position.z = radius * Math.cos( THREE.Math.degToRad( theta ) );\n\t// camera.lookAt( scene.position );\n\t// if (window.innerWidth < 800) {\n\t// \tdeviceControls.update();\n\t// }\n\t\n\t// if (window.innerWidth < 768) {\n\t\t// deviceControls.update()\n\t\t// camera.lookAt(deviceControls.gamma)\n\t\t// console.log(deviceControls);\n\t\t\n\t\t// sconsole.log(\"DEVICE CONTROLS\", deviceControls);\n\t\t// deviceControls.alpha = 0\n\t\t// deviceControls.beta = 180\n\t\t// deviceControls.gamma = 90\n\t\t// deviceControls.updateAlphaOffsetAngle(0);\n\t// }\n\t\n\t// if (window.DeviceOrientationEvent) {\n\t// \twindow.addEventListener('deviceorientation', function(event) {\n\t// \t\tlet alpha = event.alpha;\n\t// \t\tlet beta = event.beta;\n\t// \t\tlet gamma = event.gamma;\n\t// \t\t// console.log(\"We on Mobile\")\n\t// \t\t// console.log(\"GAMMA\" gamma);\n\t// \t\tdeviceControls.update();\n\t// \t\t// Do something\n\t// \t}, false);\n\t// }\n\t\n\t// deviceControls.update()\n\t\n\t// deviceControls.connect();\n\trenderer.render( scene, camera );\n\t// renderer.render( scene, camera );\n\tcamera.updateProjectionMatrix();\n\tcomposer.render();\n\t// renderer.autoClear = true;\n\t// renderer.setClearColor( 0xfff0f0 );\n\t// renderer.setClearAlpha( 0.0 );\n}\n\nTweenLite.ticker.addEventListener(\"tick\", render);\n\nfunction initStats() {\n\t// stats.setMode(0); // 0: fps, 1: ms\n\t// Align top-left\n\tstats = new Stats();\n\tstats.domElement.style.position = 'absolute';\n\t// stats.domElement.style.bottom = '0px';\n\tstats.domElement.style.left = '0px';\n\tstats.domElement.style.top = '0px';\n\tstats.domElement.style.zIndex = 100;\n\tcontainer.appendChild(stats.domElement);\n\treturn stats;\n}\n\n\nfunction deviceOrientationListener(event) {\n\tlet deg2rad = Math.PI / 180;\n\tcamera.rotation.set(\n        !event.beta * deg2rad,\n        !event.gamma ? 0 : event.gamma * deg2rad,\n        !event.alpha ? 0 : event.alpha * deg2rad\n    );\n\t\n\tconsole.log(event.beta * deg2rad)\n\tconsole.log(event.gamma * deg2rad)\n\tconsole.log(event.alpha * deg2rad)\n\t\n        // console.log(\"Do Stuff With Device\", event);\n        // ctx.clearRect(0, 0, c.width, c.height);\n        // ctx.fillStyle = \"#FF7777\";\n        // ctx.font = \"14px Verdana\";\n        // ctx.fillText(\"Alpha: \" + Math.Round(event.alpha), 10, 20);\n        // ctx.beginPath();\n        // ctx.moveTo(180, 75);\n        // ctx.lineTo(210, 75);\n        // ctx.arc(180, 75, 60, 0, event.alpha * Math.PI / 180);\n        // ctx.fill();\n\t\t// \n        // ctx.fillStyle = \"#FF6600\";\n        // ctx.fillText(\"Beta: \" + Math.round(event.beta), 10, 140);\n        // ctx.beginPath();\n        // ctx.fillRect(180, 150, event.beta, 90);\n\t\t// \n        // ctx.fillStyle = \"#FF0000\";\n        // ctx.fillText(\"Gamma: \" + Math.round(event.gamma), 10, 270);\n        // ctx.beginPath();\n        // ctx.fillRect(90, 340, 180, event.gamma);\n}\n\n//DeviceOrientationController event handling\nfunction setupControllerEventHandlers( controls ) {\n\t\n\tvar controllerEl = document.querySelector( '#controllername' );\n\tvar controllerDefaultText = controllerEl.textContent;\n\tvar controllerSelectorEl = document.querySelector( '#controllertype' );\n\tvar compassCalibrationPopupEl = document.querySelector( '#calibrate-compass-popup' );\n\t\n\t// Listen for manual interaction (zoom OR rotate)\t\n\tcontrols.addEventListener( 'userinteractionstart', function () {\n\t\trenderer.domElement.style.cursor = 'move';\n\t\tcontrollerSelectorEl.style.display = 'none';\n\t});\n\t\n\tcontrols.addEventListener( 'userinteractionend', function () {\n\t\trenderer.domElement.style.cursor = 'default';\n\t\tcontrollerSelectorEl.style.display = 'inline-block';\n\t});\n\t\n\t// Listen for manual rotate interaction\t\n\tcontrols.addEventListener( 'rotatestart', function () {\n\t\tcontrollerEl.innerText = 'Manual Rotate';\n\t});\n\t\n\tcontrols.addEventListener( 'rotateend', function () {\n\t\tcontrollerEl.innerText = controllerDefaultText;\n\t});\n\t\n\t// Listen for manual zoom interaction\n\tcontrols.addEventListener( 'zoomstart', function () {\n\t\tcontrollerEl.innerText = 'Manual Zoom';\n\t});\n\t\n\tcontrols.addEventListener( 'zoomend', function () {\n\t\tcontrollerEl.innerText = controllerDefaultText;\n\t});\n\t\n\t// Allow advanced switching between 'Quaternions' and 'Rotation Matrix' calculations\n\tcontrollerSelectorEl.addEventListener( 'click', function ( event ) {\n\t\tevent.preventDefault();\n\t\t\n\t\tif ( controls.useQuaternions === true ) {\n\t\t\tcontrollerSelectorEl.textContent = 'Rotation Matrix';\n\t\t\tcontrols.useQuaternions = false;\n\t\t} else {\n\t\t\tcontrollerSelectorEl.textContent = 'Quaternions';\n\t\t\tcontrols.useQuaternions = true;\n\t\t}\n\t}, false);\n}"]}